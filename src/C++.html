

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>C++ &mdash; Cheatsheet 1.0.0 文档</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="DTD" href="DTD.html" />
    <link rel="prev" title="CMake" href="CMake.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Cheatsheet
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="reStructuresText.html">reStructuresText</a></li>
<li class="toctree-l1"><a class="reference internal" href="sphinx.html">sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="Encoding.html">Charset and Encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="Graphviz.html">Graphviz - Graph Visualization Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="git.html">git</a></li>
<li class="toctree-l1"><a class="reference internal" href="CMake.html">CMake</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">C++</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">C++ Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-cherno">The Cherno</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#windows-c">1. 在 Windows 系统中设置 C++ 开发环境</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">2. C++ 是如何工作的</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">3. C++ 编译器是如何工作的</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">4. C++ 链接器是如何工作的</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">5. C++ 中的变量</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">6. C++ 中的函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">7. C++ 中的头文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visual-studio-c">8. 如何在 Visual Studio 中调试 C++ 程序</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-if">9. C++ 中的条件和分支（ if语句 ）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-visual-studio">10. 关于 C++ 程序最好的 Visual  Studio 设置</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-for-while">11. C++ 中的循环（for, while）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-continue-break-return">12. C++ 中的流程控制（continue, break, return）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">13. C++ 中的指针</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">14. C++ 中的引用</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">15. C++ 中的类</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">16. C++ 中类和结构体的比较</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">17. 如何写一个 C++ 的类</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-static">18. C++ 中的 Static</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">19. C++ 类和结构体中的 static</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-local-static">20. C++ 中的 Local Static</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">21. C++  中的枚举</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">22. C++ 中的构造函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16">23. C++ 中的析构函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id17">24. C++ 中的继承</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">25. C++ 中的虚函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id19">26. C++ 中的接口（纯虚函数）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id20">27. C++ 中的可见性（作用域）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">28. C++ 中的数组</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-stirng">29. C++ 中的 Stirng 是如何工作的</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id22">30. C++ 中的 Stirng 字面量</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id23">31. C++ 中的常量</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-mutable">32. C++ 中的 Mutable 关键字</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24">33. C++ 中的成员初始化列表（构造函数初始化器列表）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id25">34. 三元运算符</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id26">35. C++ 中如何创建并初始化对象</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-new">36. C++ 中的 NEW 关键字</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-explict">37. C++ 中的隐式转换和 Explict 关键字</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id27">38. C++ 中的操作符和操作符重载</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-this">39. C++ 中的 this 关键字</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id28">40. C++ 中的对象生命周期</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id29">41. C++ 中的智能指针</a></li>
<li class="toctree-l3"><a class="reference internal" href="#copying-and-copy-constructors-in-c">42. Copying and Copy Constructors in C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id30">43. C++ 中的箭头（-&gt;）操作符</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id31">44. C++ 中的动态数组</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-std-vector">45. C++ 中的 std-vector 使用优化</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id32">46. C++ 中库的使用（静态链接）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id33">47. C++ 中使用动态链接库</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id34">48. 创建和使用 C++ 库</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id35">49. C++ 中如何处理多个返回值</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id36">50. C++ 中的模板</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id37">51. C++ 中的栈和堆</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id38">52. C++ 中的宏</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-auto">53. C++ 中的 auto 关键字</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id39">54. C++ 中的静态数组</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id40">55. C++ 中的函数指针</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-lambda">56. C++ 中的 Lambda 表达式</a></li>
<li class="toctree-l3"><a class="reference internal" href="#std">57. 为什么不使用 std 命名空间</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id41">58. C++ 中的命名空间</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id42">59. C++ 中的线程</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-timing">60. C++ 中的计时（Timing）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id43">61. C++ 中的多维数组</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id44">62. C++ 中的排序</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-type-punning">63. C++ 中的（Type Punning）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-unions">64. C++ 中的 Unions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id45">65. C++ 中的虚构造函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id46">66. C++ 中的类型转换</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id47">67. C++ 中的条件和动作断点</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id48">68. 现代 C++ 中的安全</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id49">69. C++ 中的预编译头文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-dynamic-casting">70. C++ 中的动态类型转换（Dynamic Casting）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id50">71. C++ 中的性能测试（如何测量性能）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-17-structured-bindings">72. C++ 17 中的结构化绑定（Structured Bindings）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-17-optional-data">73. C++ 17 中如何处理可选数据（Optional Data）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-17">74. C++ 17 中让一个变量拥有多种类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-17-how-to-store-any-data-in-c">75. C++ 17 How to store ANY data in C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-std-async">76. 如何让 C++ 运行更快（std-async）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-17-string">77. C++ 17 如何让 String 更快</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id51">78. C++ 中让性能测试可视化</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id52">79. C++ 中的单例</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id53">80. C++ 中对短字符串的优化</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id54">81. C++ 中以最简单的方式对内存分配进行跟踪</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id55">82. C++ 的左值和右值</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id56">83. C++ 中的持续集成</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id57">84. C++ 中的静态分析</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-evaluation">85. C++ 中参数 evaluation 顺序</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-move-semantics">86. C++ 中的 Move 含义（semantics）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-move-move-assigment">87. C++ 中的 Move 和 move assigment 操作符</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id58">88. C++ 中的设计数据结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vector-dynamic-array">89. VECTOR DYNAMIC ARRAY - 设计数据结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id59">90. C++ 中的迭代器</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id60">91. 在 C++ 中写一个迭代器</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id61">92. 如何学习 C++</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="DTD.html">DTD</a></li>
<li class="toctree-l1"><a class="reference internal" href="XSD.html">XSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="WSDL.html">WSDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="dotnet.html">dotnet</a></li>
<li class="toctree-l1"><a class="reference internal" href="cmd.html">cmd</a></li>
<li class="toctree-l1"><a class="reference internal" href="SSH.html">SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="Python.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="WindowsTerminal.html">Windows Terminal</a></li>
<li class="toctree-l1"><a class="reference internal" href="manim.html">manim</a></li>
<li class="toctree-l1"><a class="reference internal" href="NSIS.html">nullsoft scriptable install system 3.0.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="Algorithm.html">Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="Vocabulary.html">Vocabulary</a></li>
<li class="toctree-l1"><a class="reference internal" href="ECFDeploy.html">ECF AutoDeploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lua.html">Lua</a></li>
<li class="toctree-l1"><a class="reference internal" href="LaTeX.html">LaTeX</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ubuntu.html">Ubuntu</a></li>
<li class="toctree-l1"><a class="reference internal" href="MEF.html">MEF in .NET Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="EMail.html">Relative Concepts of EMail</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Cheatsheet</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>C++</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/src/C++.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="c">
<h1>C++<a class="headerlink" href="#c" title="永久链接至标题">¶</a></h1>
<div class="section" id="id1">
<h2><a class="reference external" href="http://www.cplusplus.com/doc/tutorial/">C++ Tutorial</a><a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
</div>
<div class="section" id="the-cherno">
<h2>The Cherno<a class="headerlink" href="#the-cherno" title="永久链接至标题">¶</a></h2>
<div class="section" id="windows-c">
<h3>1. 在 Windows 系统中设置 C++ 开发环境<a class="headerlink" href="#windows-c" title="永久链接至标题">¶</a></h3>
<div class="figure align-center" id="id62">
<div class="graphviz"><object data="../_images/graphviz-eabfe9491e9a1ffaf4d39bce0dcb8c07a5d5aba0.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph example0{
    bgcolor = &quot;transparent&quot;
    rankdir = LR;

    a-&gt;b;
    c-&gt;a [dir = &quot;back&quot;];
}</p></object></div>
<p class="caption"><span class="caption-text">pipline</span><a class="headerlink" href="#id62" title="永久链接至图片">¶</a></p>
</div>
</div>
<div class="section" id="id2">
<h3>2. C++ 是如何工作的<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id63">
<div class="code-block-caption"><span class="caption-text">Main.cpp</span><a class="headerlink" href="#id63" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hello World!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>第1行代码中以 <code class="docutils literal notranslate"><span class="pre">#</span></code> 开头的是 <cite>预处理语句</cite> ,预处理语句将会在编译之前进行评估（be evaluated）。
这里的 <code class="docutils literal notranslate"><span class="pre">include</span></code> 表示将 <code class="docutils literal notranslate"><span class="pre">iostream</span></code> 这个 <cite>头文件</cite> 中的内容拷贝到当前源
代码文件中。</p>
<p>第3行是 <cite>mian</cite> 函数，通常 <cite>main</cite> 函数是程序的入口（entry point）, <code class="docutils literal notranslate"><span class="pre">int</span></code>
表示该函数返回的类型是整型。 <cite>main</cite> 函数中如果没有显示使用 <cite>return someIntValue;</cite>
编译器会假设为 <cite>return 0;</cite> ，只有 <cite>main</cite> 函数是这样的个例。</p>
<p>每一个 <cite>.cpp</cite> 源文件都会被编译，头文件不会被编译，只能使用 <code class="docutils literal notranslate"><span class="pre">include</span></code> 预处
理指令被包含到 <cite>.cpp</cite> 文件中进行编译。经过预处理后对每个 <cite>.cpp</cite> 文件进行 <strong>单独</strong>
地编译，每个 <cite>.cpp</cite> 文件编译后输出一个对应的 <cite>.obj</cite> 文件。最后通过链接器将
这些 <cite>.obj</cite> 文件链接成一个 <cite>.exe</cite> 可执行文件。</p>
<div class="figure align-center" id="id64">
<div class="graphviz"><object data="../_images/graphviz-b38c477298dc636730393668841d575da9f07a50.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph example {
    bgcolor = &quot;transparent&quot;
    rankdir = LR;

    a1 [label=&quot;a1.cpp&quot;];
    a2 [label=&quot;a2.cpp&quot;];
    an [label=&quot;an.cpp&quot;];
    b1 [label=&quot;b1.obj&quot;];
    b2 [label=&quot;b2.obj&quot;];
    bn [label=&quot;bn.obj&quot;];
    c [label=&quot;output.exe&quot;];
    a1 -&gt; b1;
    a2 -&gt; b2;
    an -&gt; bn;
    b1 -&gt; c;
    b2 -&gt; c;
    bn -&gt; c;
}</p></object></div>
<p class="caption"><span class="caption-text">pipline</span><a class="headerlink" href="#id64" title="永久链接至图片">¶</a></p>
</div>
<p>Visual Studio 中 <code class="docutils literal notranslate"><span class="pre">Ctrl</span> <span class="pre">+</span> <span class="pre">F7</span></code> 进行编译（compile）。</p>
<p>下面看一下存在多个 <cite>.cpp</cite> 源文件时 C++ 是如何工作的：</p>
<div class="literal-block-wrapper docutils container" id="id65">
<div class="code-block-caption"><span class="caption-text">Log.cpp</span><a class="headerlink" href="#id65" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">Log</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id66">
<div class="code-block-caption"><span class="caption-text">Main.cpp</span><a class="headerlink" href="#id66" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="kt">void</span> <span class="nf">Log</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">);</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Log</span><span class="p">(</span><span class="s">&quot;Hello World!&quot;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>在上面的代码中，如果移除 <cite>Main.cpp</cite> 中的第3行，build 整个解决方案将会出现以
下错误：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">error</span> <span class="n">C3861</span><span class="p">:</span> <span class="s1">&#39;Log&#39;</span><span class="p">:</span> <span class="n">identifier</span> <span class="ow">not</span> <span class="n">found</span>
</pre></div>
</div>
<p>此时如果我们加上第3行代码，就算没有 <cite>Log.cpp</cite> 文件，单独编译 <cite>Main.cpp</cite> 文
件也不会报错。这是因为这个第3行代码是一个 <cite>声明</cite> （表示某个 symbol 或 function 是
存在的），告诉编译器存在一个这样签名的 <cite>Log</cite> 函数（像是一个承诺，而编译器总
是选择相信我们）。</p>
<p>当我们再次 build 整个解决方案时，编译阶段没有错误，然后链接器开始工作，主要
就是 resolve symbol。如果在 <cite>Log.cpp</cite> 中没有 <cite>Log</cite> 函数的定义，将会出现以
下链接错误：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1&gt;Main.obj : error LNK2019: unresolved external symbol &quot;void __cdecl Log(char const *)&quot; (?Log@@YAXPBD@Z) referenced in function _main
1&gt;C:\dev\CppTemp\Debug\Main.exe : fatal error LNK1120: 1 unresolved externals
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>3. C++ 编译器是如何工作的<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<p>阶段：</p>
<blockquote>
<div><ol class="arabic">
<li><p>预处理</p>
<blockquote>
<div><p>evaluate 每条预处理指令；</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>预处理指令</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>#include &lt;iostream&gt;</p></td>
<td><p>拷贝头文件中的内容到使用该指令的地方</p>
<p>Visual Studio 中在</p>
<p>Properties -&gt; Configuration Properties -&gt; C/C++ -&gt; Preprocessor:</p>
<p>Preprocess to a File: No/Yes</p>
<p>修改该选项为 Yes 可输出预处理后的文件</p>
</td>
</tr>
<tr class="row-odd"><td><p>#define INTEGER int</p></td>
<td><p>将后续代码中出现的 INTEGER 替换为 int</p></td>
</tr>
<tr class="row-even"><td><p>#if #elif #else #endif</p></td>
<td><p>根据条件确定是否使用代码</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p>语法分析</p></li>
<li><p>转换成机器语言指令</p></li>
</ol>
</div></blockquote>
<p>编译后的 <cite>.obj</cite> 文件是二进制的机器码，没有可读性，为了可以简单查看编译后的内容，
可以在 Visual Studio 中的 Properties -&gt; Configuration Properties -&gt; C/C++ -&gt; Output Files:
Assemler Output: Assembly-Only Listing (/FA) 这样设置。</p>
</div>
<div class="section" id="id4">
<h3>4. C++ 链接器是如何工作的<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p>必须要有一个 entry point ，否则会产生一个链接错误。</p>
<p>可以在 Visual Studio 中的 Properties -&gt; Configuration Properties -&gt; Linker -&gt; Advanced:
Entry Point: 这里修改程序的入口。</p>
<p><strong>LINK-ERROR: 未解决的符号</strong></p>
<ul>
<li><p>代码一：</p>
<div class="literal-block-wrapper docutils container" id="id67">
<div class="code-block-caption"><span class="caption-text">Log.cpp</span><a class="headerlink" href="#id67" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">Log</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id68">
<div class="code-block-caption"><span class="caption-text">Main.cpp</span><a class="headerlink" href="#id68" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">Log</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">Multiply</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Log</span><span class="p">(</span><span class="s">&quot;Multiply&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">Multiply</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Multiply</span>
<span class="mi">40</span>
</pre></div>
</div>
</li>
<li><p>代码二：</p>
<div class="literal-block-wrapper docutils container" id="id69">
<div class="code-block-caption"><span class="caption-text">Log.cpp</span><a class="headerlink" href="#id69" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="kt">void</span> <span class="nf">Logr</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">)</span>
</span><span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id70">
<div class="code-block-caption"><span class="caption-text">Main.cpp</span><a class="headerlink" href="#id70" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">Log</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">Multiply</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Log</span><span class="p">(</span><span class="s">&quot;Multiply&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">Multiply</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>build 时将会出现以下错误信息：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1&gt;Main.obj : error LNK2019: unresolved external symbol &quot;void __cdecl Log(char const *)&quot; (?Log@@YAXPBD@Z) referenced in function &quot;int __cdecl Multiply(int,int)&quot; (?Multiply@@YAHHH@Z)
1&gt;C:\dev\C++\C++Temp\Debug\C++Temp.exe : fatal error LNK1120: 1 unresolved externals
</pre></div>
</div>
<p>错误产生是由于链接时链接器找不到与 <cite>Main.cpp</cite> 中 <code class="docutils literal notranslate"><span class="pre">Log</span></code> 函数声明那样匹配的定义。</p>
<p>此时如果注释掉 <cite>Main.cpp</cite> 中的：</p>
<div class="literal-block-wrapper docutils container" id="id71">
<div class="code-block-caption"><span class="caption-text">Main.cpp</span><a class="headerlink" href="#id71" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">//Log(&quot;Multiply&quot;);</span>
</pre></div>
</td></tr></table></div>
</div>
<p>这时再 build 将会通过，这是因为代码中没有调用 <code class="docutils literal notranslate"><span class="pre">Log</span></code> 函数，因此也就不会进行链接，
也就避免了链接错误的产生。</p>
</li>
<li><p>代码三：</p>
<div class="literal-block-wrapper docutils container" id="id72">
<div class="code-block-caption"><span class="caption-text">Log.cpp</span><a class="headerlink" href="#id72" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="kt">void</span> <span class="nf">Logr</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">)</span>
</span><span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id73">
<div class="code-block-caption"><span class="caption-text">Main.cpp</span><a class="headerlink" href="#id73" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">Log</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">Multiply</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Log</span><span class="p">(</span><span class="s">&quot;Multiply&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="c1">//std::cout &lt;&lt; Multiply(5, 8) &lt;&lt; std::endl;</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>build 时会出现以下错误信息：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1&gt;Main.obj : error LNK2019: unresolved external symbol &quot;void __cdecl Log(char const *)&quot; (?Log@@YAXPBD@Z) referenced in function &quot;int __cdecl Multiply(int,int)&quot; (?Multiply@@YAHHH@Z)
1&gt;C:\dev\C++\C++Temp\Debug\C++Temp.exe : fatal error LNK1120: 1 unresolved externals
</pre></div>
</div>
<p>这是由于链接器链接时找不到与 <cite>Main.cpp</cite> 中 <code class="docutils literal notranslate"><span class="pre">Log</span></code> 函数声明那样匹配的定义。在 <cite>Main.cpp</cite>
中虽然没有直接（ Log(“something”) ）或间接（Multiply(someInt,someInt)）调用
该 <code class="docutils literal notranslate"><span class="pre">Log</span></code> 函数的地方，但是不能保证不会有其他的文件会调用 <cite>Main.cpp</cite> 中的 <code class="docutils literal notranslate"><span class="pre">Multiply</span></code> 函数，
因此链接器会对其进行链接操作，进而生产这个链接错误。</p>
<p>然而，如果我们告诉链接器 <cite>Main.cpp</cite> 中的这个 <code class="docutils literal notranslate"><span class="pre">Multiply</span></code> 不会被其他文件调用，
又由于在 <code class="docutils literal notranslate"><span class="pre">Main.cpp</span></code> 没有直接或间接对 <code class="docutils literal notranslate"><span class="pre">Log</span></code> 函数的使用，因此链接时不会对
其进行链接操作，也就不会导致这个链接错误的产生：</p>
<div class="literal-block-wrapper docutils container" id="id74">
<div class="code-block-caption"><span class="caption-text">Main.cpp</span><a class="headerlink" href="#id74" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="n">Multiply</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</li>
</ul>
<p><strong>LINK-ERROR: 已存在的符号</strong></p>
<ul>
<li><p>代码一：</p>
<div class="literal-block-wrapper docutils container" id="id75">
<div class="code-block-caption"><span class="caption-text">Log.h</span><a class="headerlink" href="#id75" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#pragma once</span>

<span class="kt">void</span> <span class="nf">Log</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id76">
<div class="code-block-caption"><span class="caption-text">Log.cpp</span><a class="headerlink" href="#id76" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="hll"><span class="cp">#include</span><span class="cpf">&quot;Log.h&quot;</span><span class="cp"></span>
</span>
<span class="kt">void</span> <span class="nf">InitLog</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Log</span><span class="p">(</span><span class="s">&quot;Init&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id77">
<div class="code-block-caption"><span class="caption-text">Main.cpp</span><a class="headerlink" href="#id77" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="hll"><span class="cp">#include</span><span class="cpf">&quot;Log.h&quot;</span><span class="cp"></span>
</span>
<span class="kt">int</span> <span class="nf">Multiply</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Log</span><span class="p">(</span><span class="s">&quot;Multiply&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">Multiply</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>build 时会出现以下错误信息：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1&gt;Log.obj : error LNK2005: &quot;void __cdecl Log(char const *)&quot; (?Log@@YAXPBD@Z) already defined in Main.obj
1&gt;C:\dev\C++\C++Temp\Debug\C++Temp.exe : fatal error LNK1169: one or more multiply defined symbols found
</pre></div>
</div>
<p>这是由于在 <cite>Log.cpp</cite> 和 <cite>Main.cpp</cite> 文件中都使用了 <cite>#include”Log.h”</cite> 这条预处
理指令，这会将 <cite>Log.h</cite> 中的内容复制到 <cite>Log.cpp</cite> 和 <cite>Main.cpp</cite> 中，即会存在两份
<code class="docutils literal notranslate"><span class="pre">Log</span></code> 函数的定义，因此会在链接时产生符号已存在的错误。</p>
<p>有以下3种解决方式：</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><cite>Log.h</cite> 中的 <code class="docutils literal notranslate"><span class="pre">Log</span></code> 函数加上 <code class="docutils literal notranslate"><span class="pre">static</span></code> 关键字，表示仅在 include 的 .cpp 文件中自己可见</p></li>
<li><p><cite>Log.h</cite> 中的 <code class="docutils literal notranslate"><span class="pre">Log</span></code> 函数加上 <code class="docutils literal notranslate"><span class="pre">inline</span></code> 关键字，表示在调用的地方展开（类似宏展开）</p></li>
<li><p><cite>Log.h</cite> 中的 <code class="docutils literal notranslate"><span class="pre">Log</span></code> 函数移到 <cite>Log.cpp</cite> 中</p></li>
</ol>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id5">
<h3>5. C++ 中的变量<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">sizeof</span></code></p>
</div>
<div class="section" id="id6">
<h3>6. C++ 中的函数<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id7">
<h3>7. C++ 中的头文件<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">once</span></code> 告诉预处理器仅包含一次头文件。</p>
<p><code class="docutils literal notranslate"><span class="pre">include</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">&lt;xxx.h&gt;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">xxx.h&quot;</span></code>:
如果 <cite>xxx.h</cite> 文件是在当前解决方案的 <cite>include directories</cite> 中的，则使用 <code class="docutils literal notranslate"><span class="pre">&lt;xx.h&gt;</span></code> （当然也可以使用 <code class="docutils literal notranslate"><span class="pre">xxx.h</span></code> ）;
如果 <cite>xxx.h</cite> 和当前的文件存在相对路径，则使用 <code class="docutils literal notranslate"><span class="pre">&quot;xxx.h&quot;</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">../xxx.h</span></code> 。</p>
</div>
<div class="section" id="visual-studio-c">
<h3>8. 如何在 Visual Studio 中调试 C++ 程序<a class="headerlink" href="#visual-studio-c" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="c-if">
<h3>9. C++ 中的条件和分支（ if语句 ）<a class="headerlink" href="#c-if" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="c-visual-studio">
<h3>10. 关于 C++ 程序最好的 Visual  Studio 设置<a class="headerlink" href="#c-visual-studio" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="c-for-while">
<h3>11. C++ 中的循环（for, while）<a class="headerlink" href="#c-for-while" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="c-continue-break-return">
<h3>12. C++ 中的流程控制（continue, break, return）<a class="headerlink" href="#c-continue-break-return" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id8">
<h3>13. C++ 中的指针<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<p>指针是一个数整数，一个存储内存地址的数字。
在一个已存在的变量名前加 <cite>&amp;</cite> 以获取变量的地址；在一个指针前面加 <cite>*</cite> 可以对指针解
引用以获取指针指向的变量中的值。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">var</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="kt">int</span><span class="o">*</span> <span class="n">ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">var</span><span class="p">;</span>
    <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>上面代码中创建的变量是在栈里的，下面的代码则是在堆上创建了一个数组：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
    <span class="k">delete</span><span class="p">[]</span> <span class="n">buffer</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>除此之外，还可以有指向指针的指针：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>

<span class="hll">    <span class="kt">char</span><span class="o">**</span> <span class="n">ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">buffer</span><span class="p">;</span>
</span>    <span class="k">delete</span><span class="p">[]</span> <span class="n">buffer</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id9">
<h3>14. C++ 中的引用<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<p>引用不像指针那样可以设置一个为零的值，引用并不占据内存，必须进行初始化。引用只是
为已有的变量创建一个别名，本质上只有一个变量。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="hll">    <span class="kt">int</span><span class="o">&amp;</span> <span class="n">ref</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
</span><span class="hll">    <span class="n">ref</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// a = 2</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>引用是关于指针的一个语法糖，看一个在函数中修改变量值的例子：</p>
<blockquote>
<div><ul>
<li><p>使用指针：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="kt">void</span>  <span class="nf">Increment</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">value</span><span class="p">)</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">    <span class="p">(</span><span class="o">*</span><span class="n">value</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="hll">    <span class="n">Increment</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// a = 6</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</li>
<li><p>使用引用：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="kt">void</span>  <span class="nf">Increment</span><span class="p">(</span><span class="kt">int</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span>
</span><span class="p">{</span>
    <span class="n">value</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="hll">    <span class="n">Increment</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// a = 6</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id10">
<h3>15. C++ 中的类<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Player</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">speed</span><span class="p">;</span>

    <span class="kt">void</span> <span class="nf">Move</span><span class="p">(</span><span class="kt">int</span> <span class="n">xa</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ya</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">xa</span> <span class="o">*</span> <span class="n">speed</span><span class="p">;</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">ya</span> <span class="o">*</span> <span class="n">speed</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Player</span> <span class="n">player</span><span class="p">;</span>
    <span class="n">player</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">player</span><span class="p">.</span><span class="n">Move</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id11">
<h3>16. C++ 中类和结构体的比较<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>类中的成员变量的可见性默认是 <cite>private</cite> 而结构体中成员变量的可见性默认是 <cite>public</cite>；</p></li>
<li><p>尽量不要在结构体中使用继承。</p></li>
</ul>
</div>
<div class="section" id="id12">
<h3>17. 如何写一个 C++ 的类<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Log</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">ErrorLevel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">WarningLevel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">InfoLevel</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">private</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">m_LogLevel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">SetLevel</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_LogLevel</span> <span class="o">=</span> <span class="n">level</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">Error</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">m_LogLevel</span> <span class="o">&gt;=</span> <span class="n">ErrorLevel</span><span class="p">)</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;[ERROR]: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">Warning</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">m_LogLevel</span> <span class="o">&gt;=</span> <span class="n">WarningLevel</span><span class="p">)</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;[WARNING]: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">Info</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">m_LogLevel</span> <span class="o">&gt;=</span> <span class="n">InfoLevel</span><span class="p">)</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;[INFO]: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Log</span> <span class="n">log</span><span class="p">;</span>
    <span class="n">log</span><span class="p">.</span><span class="n">SetLevel</span><span class="p">(</span><span class="n">log</span><span class="p">.</span><span class="n">ErrorLevel</span><span class="p">);</span>
    <span class="n">log</span><span class="p">.</span><span class="n">Error</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">);</span>
    <span class="n">log</span><span class="p">.</span><span class="n">Warning</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">);</span>
    <span class="n">log</span><span class="p">.</span><span class="n">Info</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="c-static">
<h3>18. C++ 中的 Static<a class="headerlink" href="#c-static" title="永久链接至标题">¶</a></h3>
<p>C++ 中的 <cite>static</cite> 主要有两种不同的使用场景：</p>
<blockquote>
<div><ul class="simple">
<li><p>在类或结构体内部使用 <cite>static</cite> ;</p></li>
<li><p>在类或结构体外部使用 <cite>static</cite> ;</p></li>
</ul>
</div></blockquote>
<p>下面展示一些类或结构体外部使用 <cite>static</cite> 的代码片段：</p>
<ul>
<li><p>场景一</p>
<div class="literal-block-wrapper docutils container" id="id78">
<div class="code-block-caption"><span class="caption-text">Static.cpp</span><a class="headerlink" href="#id78" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="kt">int</span> <span class="n">s_Variable</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id79">
<div class="code-block-caption"><span class="caption-text">Sandbox.cpp</span><a class="headerlink" href="#id79" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="kt">int</span> <span class="n">s_Variable</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s_Variable</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>将会出现编译错误：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1&gt;Static.obj : error LNK2005: &quot;int s_Variable&quot; (?s_Variable@@3HA) already defined in Sandbox.obj
1&gt;C:\dev\CppTemp\Debug\Sandbox.exe : fatal error LNK1169: one or more multiply defined symbols found
</pre></div>
</div>
<p>由于这里（一个编译单元 – translation unit）有两个同名的全局变量 <cite>s_Variable</cite> 。</p>
</li>
<li><p>场景二：</p>
<div class="literal-block-wrapper docutils container" id="id80">
<div class="code-block-caption"><span class="caption-text">Static.cpp</span><a class="headerlink" href="#id80" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="k">static</span> <span class="kt">int</span> <span class="n">s_Variable</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id81">
<div class="code-block-caption"><span class="caption-text">Sandbox.cpp</span><a class="headerlink" href="#id81" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="kt">int</span> <span class="n">s_Variable</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s_Variable</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// output will be 10</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>在 <cite>static.cpp</cite> 中定义的 <code class="docutils literal notranslate"><span class="pre">s_Variable</span></code> 由于有 <code class="docutils literal notranslate"><span class="pre">static</span></code> 修饰，其作用
类似于使其修饰的变量仅在当前 <cite>.cpp</cite> 文件中可见，因此没有出现场景一中链接错
误。若在头文件中像这样定义 <code class="docutils literal notranslate"><span class="pre">static</span></code> 修饰的变量，在每一个使用该头文件的 <cite>.cpp</cite>
文件中都会各自定义一个 <code class="docutils literal notranslate"><span class="pre">static</span></code> 变量，这是因为引用头文件本质是将其代码进
行复制。</p>
</li>
<li><p>场景三：</p>
<div class="literal-block-wrapper docutils container" id="id82">
<div class="code-block-caption"><span class="caption-text">Static.cpp</span><a class="headerlink" href="#id82" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="kt">int</span> <span class="n">s_Variable</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id83">
<div class="code-block-caption"><span class="caption-text">Sandbox.cpp</span><a class="headerlink" href="#id83" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="k">extern</span> <span class="kt">int</span> <span class="n">s_Variable</span><span class="p">;</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s_Variable</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// output will be 5</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>在 <cite>static.cpp</cite> 中定义的 <code class="docutils literal notranslate"><span class="pre">s_Variable</span></code> 没有 <code class="docutils literal notranslate"><span class="pre">static</span></code> 修饰，因此该定义
对于 <cite>Sandbox.cpp</cite> 是可见的。</p>
</li>
</ul>
</div>
<div class="section" id="id13">
<h3>19. C++ 类和结构体中的 static<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">struct</span>  <span class="n">Entity</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">void</span> <span class="nf">Print</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; , &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">entity</span><span class="p">;</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="n">Entity</span>  <span class="n">entity1</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">5</span><span class="p">,</span><span class="mi">8</span> <span class="p">};</span>

    <span class="n">entity</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>  <span class="c1">// output will be &quot;2 , 3&quot;</span>
    <span class="n">entity1</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span> <span class="c1">// output will be &quot;5 , 8&quot;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>将成员变量 <code class="docutils literal notranslate"><span class="pre">x</span></code> 和 <code class="docutils literal notranslate"><span class="pre">y</span></code> 加上 <code class="docutils literal notranslate"><span class="pre">static</span></code> 修饰：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">struct</span>  <span class="n">Entity</span>
<span class="p">{</span>
<span class="hll">    <span class="k">static</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
</span>    <span class="kt">void</span> <span class="nf">Print</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; , &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">entity</span><span class="p">;</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="hll">    <span class="n">Entity</span>  <span class="n">entity1</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">5</span><span class="p">,</span><span class="mi">8</span> <span class="p">};</span>
</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>
    <span class="n">entity1</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>由于此时 <code class="docutils literal notranslate"><span class="pre">x</span></code> 和 <code class="docutils literal notranslate"><span class="pre">y</span></code> 不是实例中的成员，因此编译时将出现以下错误：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="o">&gt;</span><span class="n">C</span><span class="p">:</span>\<span class="n">dev</span>\<span class="n">CppTemp</span>\<span class="n">Debug</span>\<span class="n">Sandbox</span><span class="o">.</span><span class="n">exe</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">25</span><span class="p">):</span> <span class="n">error</span> <span class="n">C2078</span><span class="p">:</span> <span class="n">too</span> <span class="n">many</span> <span class="n">initializers</span>
</pre></div>
</div>
<p>继续调整如下：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">struct</span>  <span class="n">Entity</span>
<span class="p">{</span>
<span class="hll">    <span class="k">static</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
</span>    <span class="kt">void</span> <span class="nf">Print</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; , &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">entity</span><span class="p">;</span>
<span class="hll">    <span class="n">entity</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class="hll">    <span class="n">entity</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span>
    <span class="n">Entity</span> <span class="n">entity1</span><span class="p">;</span>
<span class="hll">    <span class="n">entity1</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class="hll">    <span class="n">entity1</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
</span>
<span class="hll">    <span class="n">entity</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>
</span><span class="hll">    <span class="n">entity1</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>编译时出现以下错误：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1&gt;Sandbox.obj : error LNK2001: unresolved external symbol &quot;public: static int Entity::x&quot; (?x@Entity@@2HA)
1&gt;Sandbox.obj : error LNK2001: unresolved external symbol &quot;public: static int Entity::y&quot; (?y@Entity@@2HA)
1&gt;C:\dev\CppTemp\Debug\Sandbox.exe : fatal error LNK1120: 2 unresolved externals
</pre></div>
</div>
<p>继续调整如下：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">struct</span>  <span class="n">Entity</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">void</span> <span class="nf">Print</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; , &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="hll"><span class="kt">int</span> <span class="n">Entity</span><span class="o">::</span><span class="n">x</span><span class="p">;</span>
</span><span class="hll"><span class="kt">int</span> <span class="n">Entity</span><span class="o">::</span><span class="n">y</span><span class="p">;</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">entity</span><span class="p">;</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="n">Entity</span> <span class="n">entity1</span><span class="p">;</span>
    <span class="n">entity1</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">entity1</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>

<span class="hll">    <span class="n">entity</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>     <span class="c1">// output will be &quot;5, 8&quot;</span>
</span><span class="hll">    <span class="n">entity1</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>    <span class="c1">// output will be &quot;5, 8&quot;</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>上述代码等效于：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">struct</span>  <span class="n">Entity</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">void</span> <span class="nf">Print</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; , &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">Entity</span><span class="o">::</span><span class="n">x</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">Entity</span><span class="o">::</span><span class="n">y</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">entity</span><span class="p">;</span>
<span class="hll">    <span class="n">Entity</span><span class="o">::</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class="hll">    <span class="n">Entity</span><span class="o">::</span><span class="n">y</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span>
    <span class="n">Entity</span> <span class="n">entity1</span><span class="p">;</span>
<span class="hll">    <span class="n">Entity</span><span class="o">::</span><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class="hll">    <span class="n">Entity</span><span class="o">::</span><span class="n">y</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>     <span class="c1">// output will be &quot;5, 8&quot;</span>
    <span class="n">entity1</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>    <span class="c1">// output will be &quot;5, 8&quot;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="c-local-static">
<h3>20. C++ 中的 Local Static<a class="headerlink" href="#c-local-static" title="永久链接至标题">¶</a></h3>
<p>函数第一次被调用时，函数中的 static 变量将被创建一次，后续被调用时将不会再创建。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">Function</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="k">static</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span>    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Function</span><span class="p">();</span>     <span class="c1">// output will be &quot;1&quot;</span>
    <span class="n">Function</span><span class="p">();</span>     <span class="c1">// output will be &quot;2&quot;</span>
    <span class="n">Function</span><span class="p">();</span>     <span class="c1">// output will be &quot;3&quot;</span>
    <span class="n">Function</span><span class="p">();</span>     <span class="c1">// output will be &quot;4&quot;</span>
    <span class="n">Function</span><span class="p">();</span>     <span class="c1">// output will be &quot;5&quot;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>上面的代码等效于下面的代码，只是限制了变量 <code class="docutils literal notranslate"><span class="pre">i</span></code> 只能在函数 <code class="docutils literal notranslate"><span class="pre">Function()</span></code> 中访问：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="k">static</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="kt">void</span> <span class="nf">Function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Function</span><span class="p">();</span>     <span class="c1">// output will be &quot;1&quot;</span>
    <span class="n">Function</span><span class="p">();</span>     <span class="c1">// output will be &quot;2&quot;</span>
    <span class="n">Function</span><span class="p">();</span>     <span class="c1">// output will be &quot;3&quot;</span>
    <span class="n">Function</span><span class="p">();</span>     <span class="c1">// output will be &quot;4&quot;</span>
    <span class="n">Function</span><span class="p">();</span>     <span class="c1">// output will be &quot;5&quot;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>通常的单例模式代码：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Singleton</span>
<span class="p">{</span>
<span class="hll"><span class="k">private</span><span class="o">:</span>
</span><span class="hll">    <span class="k">static</span> <span class="n">Singleton</span><span class="o">*</span> <span class="n">s_Instance</span><span class="p">;</span>
</span>
<span class="k">public</span><span class="o">:</span>
<span class="hll">    <span class="k">static</span> <span class="n">Singleton</span><span class="o">&amp;</span> <span class="n">Get</span><span class="p">()</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="k">return</span> <span class="o">*</span><span class="n">s_Instance</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span>    <span class="kt">void</span> <span class="n">SomeFunc</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="hll"><span class="n">Singleton</span><span class="o">*</span> <span class="n">Singleton</span><span class="o">::</span><span class="n">s_Instance</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="n">Singleton</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">SomeFunc</span><span class="p">();</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>使用本节中的 <cite>Local Static</cite> 后代码更简洁：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Singleton</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="hll">    <span class="k">static</span> <span class="n">Singleton</span><span class="o">&amp;</span> <span class="n">Get</span><span class="p">()</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="k">static</span> <span class="n">Singleton</span> <span class="n">instance</span><span class="p">;</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">instance</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span>    <span class="kt">void</span> <span class="n">SomeFunc</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Singleton</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">SomeFunc</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id14">
<h3>21. C++  中的枚举<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Log</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="hll">    <span class="k">enum</span> <span class="n">Level</span> <span class="c1">//  [ : [ unsigned ] char | int ]</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">LevelError</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span class="hll">        <span class="n">LevelWarning</span><span class="p">,</span>
</span><span class="hll">        <span class="n">LevelInfo</span>
</span><span class="hll">    <span class="p">};</span>
</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">Level</span> <span class="n">m_LogLevel</span> <span class="o">=</span> <span class="n">LevelInfo</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">SetLevel</span><span class="p">(</span><span class="n">Level</span> <span class="n">level</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_LogLevel</span> <span class="o">=</span> <span class="n">level</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">Error</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
<span class="hll">        <span class="k">if</span> <span class="p">(</span><span class="n">m_LogLevel</span> <span class="o">&gt;=</span> <span class="n">LevelError</span><span class="p">)</span>
</span>            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;[ERROR]: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">Warning</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
<span class="hll">        <span class="k">if</span> <span class="p">(</span><span class="n">m_LogLevel</span> <span class="o">&gt;=</span> <span class="n">LevelWarning</span><span class="p">)</span>
</span>            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;[WARNING]: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">Info</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
<span class="hll">        <span class="k">if</span> <span class="p">(</span><span class="n">m_LogLevel</span> <span class="o">&gt;=</span> <span class="n">LevelInfo</span><span class="p">)</span>
</span>            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;[INFO]: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Log</span> <span class="n">log</span><span class="p">;</span>
<span class="hll">    <span class="n">log</span><span class="p">.</span><span class="n">SetLevel</span><span class="p">(</span><span class="n">Log</span><span class="o">::</span><span class="n">LevelError</span><span class="p">);</span>
</span>    <span class="n">log</span><span class="p">.</span><span class="n">Error</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">);</span>
    <span class="n">log</span><span class="p">.</span><span class="n">Warning</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">);</span>
    <span class="n">log</span><span class="p">.</span><span class="n">Info</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>上面的代码中 <cite>enum Level</cite> 并不是一个名称空间，因此这样访问 <code class="docutils literal notranslate"><span class="pre">Log::LevelError</span></code>
而不是这样访问 <code class="docutils literal notranslate"><span class="pre">Level::LevelError</span></code> ;另外由于此处枚举的本质是整数，因
此可以使用比较运算符 <cite>m_LogLevel &gt;= LevelError</cite> 。</p>
</div>
<div class="section" id="id15">
<h3>22. C++ 中的构造函数<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h3>
<p>构造函数是一个特殊的方法，在实例化对象的时候被调用。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>

    <span class="kt">void</span> <span class="nf">Print</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; , &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">entity</span><span class="p">;</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>上面的代码会得到类似以下的输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mf">1.07374e+08</span> <span class="p">,</span> <span class="o">-</span><span class="mf">1.07374e+08</span>
</pre></div>
</div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>

    <span class="kt">void</span> <span class="nf">Print</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; , &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">entity</span><span class="p">;</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">entity</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; , &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">entity</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>上面的代码将会出现编译错误：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">error</span> <span class="n">C4700</span><span class="p">:</span> <span class="n">uninitialized</span> <span class="n">local</span> <span class="n">variable</span> <span class="s1">&#39;entity&#39;</span> <span class="n">used</span>
</pre></div>
</div>
<p>这是由于 C++ 类中基础类型的成员变量默认将不会被初始化为“零”，必须手动对其进
行初始化，可以像下面代码中那样写一个构造函数来初始化：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">float</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">;</span>

<span class="hll">    <span class="n">Entity</span><span class="p">()</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">X</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
</span><span class="hll">        <span class="n">Y</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span>
    <span class="kt">void</span> <span class="n">Print</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">X</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; , &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">entity</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">entity</span><span class="p">.</span><span class="n">X</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; , &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">entity</span><span class="p">.</span><span class="n">Y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>  <span class="c1">// 将会正确输出</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span> <span class="c1">// 将会正确输出</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>如果在 C++ 类中没有显示地通过代码创建构造函数，编译器将会实现一个默认的 <cite>public</cite>
的“空”构造函数：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Entity</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>如果不希望编译器创建默认的构造函数，可以添加下面的代码：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Entity</span><span class="p">()</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>另外，可以创建需要传递参数的构造函数：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">float</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">;</span>

    <span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">X</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="p">}</span>

<span class="hll">    <span class="n">Entity</span><span class="p">(</span><span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y</span><span class="p">)</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">X</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
</span><span class="hll">        <span class="n">Y</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span>
    <span class="kt">void</span> <span class="n">Print</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">X</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; , &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">entity1</span><span class="p">;</span>
<span class="hll">    <span class="n">Entity</span> <span class="n">entity2</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span>    <span class="n">entity1</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>    <span class="c1">// 0 , 0</span>
<span class="hll">    <span class="n">entity2</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>    <span class="c1">// 10 , 5</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id16">
<h3>23. C++ 中的析构函数<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h3>
<p>当对象被销毁的时候析构函数将会被调用，通常在析构函数中释放在构造函数中分配在
堆中的内存；当然也可以手动调用析构函数，但是很少这样做，注意析构函数会被多次调用。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">float</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">;</span>

    <span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">X</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Created Entity!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

<span class="hll">    <span class="o">~</span><span class="n">Entity</span><span class="p">()</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Destroyed Entity!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span>
    <span class="kt">void</span> <span class="n">Print</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">X</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; , &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="hll"><span class="kt">void</span> <span class="nf">Function</span><span class="p">()</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">    <span class="n">Entity</span> <span class="n">entity</span><span class="p">;</span>
</span><span class="hll">    <span class="n">entity</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="n">Function</span><span class="p">();</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出为：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Created Entity!
0 , 0
Destroyed Entity!
</pre></div>
</div>
</div>
<div class="section" id="id17">
<h3>24. C++ 中的继承<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">float</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">;</span>

    <span class="kt">void</span> <span class="nf">Move</span><span class="p">(</span><span class="kt">float</span> <span class="n">xa</span><span class="p">,</span> <span class="kt">float</span> <span class="n">ya</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">X</span> <span class="o">+=</span> <span class="n">xa</span><span class="p">;</span>
        <span class="n">Y</span> <span class="o">+=</span> <span class="n">ya</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="hll"><span class="k">class</span> <span class="nc">Player</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Entity</span>
</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">Name</span><span class="p">;</span>

    <span class="n">Player</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">PrintName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">Name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Entity</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// output will be &quot;8&quot;</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// output will be &quot;12&quot;</span>
</span>
<span class="hll">    <span class="n">Player</span> <span class="n">player</span><span class="p">(</span><span class="s">&quot;playerA&quot;</span><span class="p">);</span>
</span><span class="hll">    <span class="n">player</span><span class="p">.</span><span class="n">Move</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span><span class="hll">    <span class="n">player</span><span class="p">.</span><span class="n">X</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class="hll">    <span class="n">player</span><span class="p">.</span><span class="n">PrintName</span><span class="p">();</span>
</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id18">
<h3>25. C++ 中的虚函数<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;Entity&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Player</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_Name</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Player</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span> <span class="o">:</span><span class="n">m_Name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">m_Name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="hll"><span class="kt">void</span> <span class="nf">PrintName</span><span class="p">(</span><span class="n">Entity</span><span class="o">*</span> <span class="n">entity</span><span class="p">)</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span><span class="o">*</span> <span class="n">entity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="p">();</span>
    <span class="n">Player</span><span class="o">*</span> <span class="n">player</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Player</span><span class="p">(</span><span class="s">&quot;Cherno&quot;</span><span class="p">);</span>

<span class="hll">    <span class="n">PrintName</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>  <span class="c1">// output will be &quot;Entity&quot;</span>
</span><span class="hll">    <span class="n">PrintName</span><span class="p">(</span><span class="n">player</span><span class="p">);</span>  <span class="c1">// output will be &quot;Entity&quot;</span>
</span>
    <span class="k">delete</span> <span class="n">entity</span><span class="p">;</span>
    <span class="k">delete</span> <span class="n">player</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>使用虚函数后（包含 V-Table），有两个额外花销，保存 V-Table 的空间和调用时查表:</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="hll">    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetName</span><span class="p">()</span>
</span>    <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;Entity&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Player</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_Name</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Player</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span> <span class="o">:</span><span class="n">m_Name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetName</span><span class="p">()</span> <span class="k">override</span> <span class="c1">// C++ 11 中 override 可选，为了可读性，建议加上</span>
</span>    <span class="p">{</span>
        <span class="k">return</span> <span class="n">m_Name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">PrintName</span><span class="p">(</span><span class="n">Entity</span><span class="o">*</span> <span class="n">entity</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">entity</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span><span class="o">*</span> <span class="n">entity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="p">();</span>
    <span class="n">Player</span><span class="o">*</span> <span class="n">player</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Player</span><span class="p">(</span><span class="s">&quot;Cherno&quot;</span><span class="p">);</span>

<span class="hll">    <span class="n">PrintName</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>  <span class="c1">// output will be &quot;Entity&quot;</span>
</span><span class="hll">    <span class="n">PrintName</span><span class="p">(</span><span class="n">player</span><span class="p">);</span>  <span class="c1">// output will be &quot;Cherno&quot;</span>
</span>
    <span class="k">delete</span> <span class="n">entity</span><span class="p">;</span>
    <span class="k">delete</span> <span class="n">player</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id19">
<h3>26. C++ 中的接口（纯虚函数）<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h3>
<p>C++ 中的包含纯虚函数的类就是“抽象类”，若所有方法都是纯虚函数，则是“接口”，包含未
实现纯的虚函数的类不能进行实例化操作。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Printable</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="hll">    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetClassName</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="p">};</span>

<span class="k">class</span> <span class="nc">Entity</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Printable</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetClassName</span><span class="p">()</span> <span class="k">override</span> <span class="c1">// C++ 11 中 override 可选，为了可读性，建议加上</span>
</span>    <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;Entity&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Player</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetClassName</span><span class="p">()</span> <span class="k">override</span> <span class="c1">// C++ 11 中 override 可选，为了可读性，建议加上</span>
</span>    <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;Player&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">Print</span><span class="p">(</span><span class="n">Printable</span><span class="o">*</span> <span class="n">obj</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">GetClassName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span><span class="o">*</span> <span class="n">entity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="p">();</span>
    <span class="n">Player</span><span class="o">*</span> <span class="n">player</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Player</span><span class="p">();</span>

    <span class="n">Print</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>  <span class="c1">// output will be &quot;Entity&quot;</span>
    <span class="n">Print</span><span class="p">(</span><span class="n">player</span><span class="p">);</span>  <span class="c1">// output will be &quot;Player&quot;</span>

    <span class="k">delete</span> <span class="n">entity</span><span class="p">;</span>
    <span class="k">delete</span> <span class="n">player</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id20">
<h3>27. C++ 中的可见性（作用域）<a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h3>
<p>可见性是指类中的属性或者方法的可见性，C++ 中有三种可见性，分别是 <code class="docutils literal notranslate"><span class="pre">public</span></code> 、 <code class="docutils literal notranslate"><span class="pre">protected</span></code> 和 <code class="docutils literal notranslate"><span class="pre">private</span></code>。
类中的可见性默认是 <code class="docutils literal notranslate"><span class="pre">private</span></code>, 结构体中的可见性默认是 <code class="docutils literal notranslate"><span class="pre">public</span></code> 。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>可见性</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>private</p></td>
<td><p>修饰后的成员只能在 <strong>当前类</strong> 或者 <strong>友元</strong> 中进行访问</p></td>
</tr>
<tr class="row-odd"><td><p>protected</p></td>
<td><p>修饰后的成员只能在 <strong>当前类</strong> 或者 <strong>派生类</strong> 中进行访问</p></td>
</tr>
<tr class="row-even"><td><p>public</p></td>
<td><p>修饰后的成员在任何地方都可进行访问</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id21">
<h3>28. C++ 中的数组<a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">example</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
    <span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">example</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>   <span class="c1">// 访问数组中元素</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">example</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>      <span class="c1">// 数组的地址</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>在上面的代码中数组名称就是一个指向整型（元素类型）的指针：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">example</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="hll">    <span class="kt">int</span><span class="o">*</span> <span class="n">ptr</span> <span class="o">=</span> <span class="n">example</span><span class="p">;</span>
</span>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">example</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">example</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">example</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="c1">// 5</span>
<span class="hll">    <span class="o">*</span><span class="p">(</span><span class="n">ptr</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">example</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="c1">// 6</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>有时需要通过 <cite>new</cite> 关键字来创建数组，主要是考虑到数组对象的生命周期问题。如果需要
在某个方法种创建并返回数组，则通常需使用 <cite>new</cite> 关键字来创建数组，同时必须在代码中
调用 <cite>delete</cite> 来删除该数组，在此调用之前，该数组将会一直存在：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="kt">int</span> <span class="n">example</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>                 <span class="c1">// 存储在栈中</span>
</span>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">example</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>

<span class="hll">    <span class="kt">int</span><span class="o">*</span> <span class="n">another</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>      <span class="c1">// 存储在堆中</span>
</span>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">another</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>

<span class="hll">    <span class="k">delete</span><span class="p">[]</span> <span class="n">another</span><span class="p">;</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>C++ 中的数组无法直接获取其中包含的元素的数量：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="hll">    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span> <span class="c1">// 5</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">count</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="kt">int</span><span class="o">*</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="hll">    <span class="n">count</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span> <span class="c1">// 0</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">count</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>在 C++ 11 中可以通过以下代码获取数组中元素的数量，但是会有额外的开销：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="hll"><span class="cp">#include</span><span class="cpf">&lt;array&gt;</span><span class="cp"></span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">5</span><span class="o">&gt;</span> <span class="n">c</span><span class="p">;</span>
</span><span class="hll">    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">count</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// 5</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="c-stirng">
<h3>29. C++ 中的 Stirng 是如何工作的<a class="headerlink" href="#c-stirng" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>C 风格字符串：</p></li>
</ul>
<blockquote>
<div><p><strong>双引号</strong> 的类型默认为 <code class="docutils literal notranslate"><span class="pre">char*</span></code> , 使用 <strong>单引号</strong> 的类型为 <code class="docutils literal notranslate"><span class="pre">char</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">char*</span> <span class="pre">name</span> <span class="pre">=</span> <span class="pre">&quot;Cherno&quot;;</span></code> 这里使用了 C 风格的代码来表示字符串，虽然这里的 <code class="docutils literal notranslate"><span class="pre">name</span></code> 是
一个指针类型，但不需要通过 <code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">name</span></code> 来清理内存，记住仅在使用 new 关键字分
配内存的时候才使用 <code class="docutils literal notranslate"><span class="pre">delete</span></code> 清理内存。 <em>内存中从指针开始到后面的第一个存储值为
0的字节部分为字符串的内容。</em> 这也是下面代码中使用 <code class="docutils literal notranslate"><span class="pre">std::cout</span></code> 可以输出完整字符
串的原因（name2、name3可是指针）。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="hll">
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">name2</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="sc">&#39;C&#39;</span><span class="p">,</span><span class="sc">&#39;h&#39;</span><span class="p">,</span><span class="sc">&#39;e&#39;</span><span class="p">,</span><span class="sc">&#39;r&#39;</span><span class="p">,</span><span class="sc">&#39;n&#39;</span><span class="p">,</span><span class="sc">&#39;o&#39;</span><span class="p">,</span><span class="sc">&#39;\0&#39;</span> <span class="p">};</span>
    <span class="kt">char</span> <span class="n">name3</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="sc">&#39;C&#39;</span><span class="p">,</span><span class="sc">&#39;h&#39;</span><span class="p">,</span><span class="sc">&#39;e&#39;</span><span class="p">,</span><span class="sc">&#39;r&#39;</span><span class="p">,</span><span class="sc">&#39;n&#39;</span><span class="p">,</span><span class="sc">&#39;o&#39;</span><span class="p">,</span><span class="mi">0</span> <span class="p">};</span>

<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">name2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// output will be &quot;7&quot;</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">name3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// output will be &quot;6&quot;</span>
</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">name2</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// output will be &quot;Cherno&quot;</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">name3</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// output will be &quot;Cherno&quot;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<ul>
<li><p>C++ 风格字符串：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="hll"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Cherno&quot;</span><span class="p">;</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">name</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>  <span class="c1">// output will be &quot;6&quot;</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>         <span class="c1">// output will be &quot;Cherno&quot;</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>使用下面两种方式进行字符串的拼接：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Cherno&quot;</span><span class="p">;</span>
<span class="n">name</span> <span class="o">+=</span> <span class="s">&quot;another&quot;</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">&quot;Cherno&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;another&quot;</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id22">
<h3>30. C++ 中的 Stirng 字面量<a class="headerlink" href="#id22" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="k">const</span> <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Che</span><span class="se">\0</span><span class="s">rno&quot;</span><span class="p">;</span>        <span class="c1">// \0 represents NUL</span>
</span>    <span class="c1">//const char name[] = &quot;Che\0rno&quot;        // same as above</span>

<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>  <span class="c1">// output will be &quot;3&quot;</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>          <span class="c1">// output will be &quot;Che&quot;</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Cherno&quot;</span><span class="p">;</span> <span class="c1">// or u8&quot;Cherno&quot;   // UTF-8,1 bytes per character</span>
</span>    <span class="k">const</span> <span class="kt">wchar_t</span><span class="o">*</span> <span class="n">name2</span> <span class="o">=</span> <span class="sa">L</span><span class="s">&quot;Cherno&quot;</span><span class="p">;</span>               <span class="c1">// 1 or 2 or 4 byte(s) per character</span>
    <span class="k">const</span> <span class="kt">char16_t</span><span class="o">*</span> <span class="n">name3</span> <span class="o">=</span> <span class="sa">u</span><span class="s">&quot;Cherno&quot;</span><span class="p">;</span>              <span class="c1">// UTF-16,2 bytes per character</span>
<span class="hll">    <span class="k">const</span> <span class="kt">char32_t</span><span class="o">*</span> <span class="n">name4</span> <span class="o">=</span> <span class="sa">U</span><span class="s">&quot;Cherno&quot;</span><span class="p">;</span>              <span class="c1">// UTF-32,4 bytes per character</span>
</span><span class="hll">
</span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s_name</span> <span class="o">=</span> <span class="s">&quot;Cherno&quot;</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">wstring</span> <span class="n">s_name2</span> <span class="o">=</span> <span class="sa">L</span><span class="s">&quot;Cherno&quot;</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">u16string</span> <span class="n">s_name3</span> <span class="o">=</span> <span class="sa">u</span><span class="s">&quot;Cherno&quot;</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">u32string</span> <span class="n">s_name4</span> <span class="o">=</span> <span class="sa">U</span><span class="s">&quot;Cherno&quot;</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">paragraph</span> <span class="o">=</span> <span class="sa">R</span><span class="s">&quot;</span><span class="dl">(</span><span class="s">Line1</span>
<span class="s">Line2</span>
<span class="s">Line3</span>
<span class="s">Line4</span><span class="dl">)</span><span class="s">&quot;</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">paragraph2</span> <span class="o">=</span> <span class="s">&quot;Line1</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="s">&quot;Line2</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="s">&quot;Line3</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="s">&quot;Line4</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">paragraph</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">paragraph2</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出为：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Line1</span>
<span class="n">Line2</span>
<span class="n">Line3</span>
<span class="n">Line4</span>
<span class="n">Line1</span>
<span class="n">Line2</span>
<span class="n">Line3</span>
<span class="n">Line4</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>字符串总是存储在只读的内存空间中。</p>
</div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;Cherno&quot;</span><span class="p">;</span>
<span class="hll">    <span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;a&#39;</span><span class="p">;</span>
</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// output will be &quot;Charno&quot;</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id23">
<h3>31. C++ 中的常量<a class="headerlink" href="#id23" title="永久链接至标题">¶</a></h3>
<p>使用 <cite>const</cite> 修饰的变量表示其不希望在程序中被修改。</p>
<ul>
<li><p>基本使用场景：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_AGE</span> <span class="o">=</span> <span class="mi">90</span><span class="p">;</span>
</span>    <span class="kt">int</span><span class="o">*</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">;</span>

    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">MAX_AGE</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</li>
<li><p>修饰类中的成员方法：</p>
<blockquote>
<div><p>表示方法不会对成员变量进行修改。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span>  <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">m_X</span><span class="p">,</span> <span class="n">m_Y</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
<span class="hll">    <span class="kt">int</span> <span class="n">GetX</span><span class="p">()</span> <span class="k">const</span>
</span>    <span class="p">{</span>
        <span class="k">return</span> <span class="n">m_X</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">SetX</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_X</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="hll"><span class="kt">void</span> <span class="nf">PrinEntity</span><span class="p">(</span><span class="k">const</span> <span class="n">Entity</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">GetX</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">e</span><span class="p">;</span>
<span class="hll">    <span class="n">PrinEntity</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="c-mutable">
<h3>32. C++ 中的 Mutable 关键字<a class="headerlink" href="#c-mutable" title="永久链接至标题">¶</a></h3>
<p><cite>Mutable</cite> 单词的意思为“可以修改的”，C++ 中主要又两个使用场景，分别是：</p>
<blockquote>
<div><ul class="simple">
<li><p>Const 常量相关</p></li>
<li><p>Lambda 表达式相关</p></li>
</ul>
</div></blockquote>
<ul>
<li><p>在常量上下文中的 mutable 使用：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span>  <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_Name</span><span class="p">;</span>
</span><span class="k">public</span><span class="o">:</span>
<span class="hll">    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">GetName</span><span class="p">()</span> <span class="k">const</span>
</span>    <span class="p">{</span>
<span class="hll">        <span class="k">return</span> <span class="n">m_Name</span><span class="p">;</span>
</span>    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="n">Entity</span> <span class="n">e</span><span class="p">;</span>
    <span class="n">e</span><span class="p">.</span><span class="n">GetName</span><span class="p">();</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>使用 <cite>mutable</cite> 关键字修饰的类成员变量使其可以在 const 方法中被修改：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span>  <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_Name</span><span class="p">;</span>
<span class="hll">    <span class="k">mutable</span> <span class="kt">int</span> <span class="n">m_DebugCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span>
<span class="k">public</span><span class="o">:</span>
<span class="hll">    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">GetName</span><span class="p">()</span> <span class="k">const</span>
</span>    <span class="p">{</span>
<span class="hll">        <span class="n">m_DebugCount</span><span class="o">++</span><span class="p">;</span>
</span>        <span class="k">return</span> <span class="n">m_Name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="n">Entity</span> <span class="n">e</span><span class="p">;</span>
    <span class="n">e</span><span class="p">.</span><span class="n">GetName</span><span class="p">();</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</div></blockquote>
</li>
<li><p>在 Lambda 上下文中使用 mutable:</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="hll">    <span class="k">auto</span> <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="o">=</span><span class="p">]()</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
</span><span class="hll">        <span class="n">y</span><span class="o">++</span><span class="p">;</span>
</span><span class="hll">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class="hll">    <span class="p">};</span>
</span>
    <span class="n">f</span><span class="p">();</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p><cite>[=]</cite> 表示在 Lambda 中对外部的局部变量以值拷贝的方式使用，<cite>[&amp;]</cite> 表示以引用的
方式使用。使用 <cite>mutable</cite> 关键字修饰 Lambda 可以对上面的代码进行简化：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="hll">    <span class="k">auto</span> <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="o">=</span><span class="p">]()</span> <span class="k">mutable</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class="hll">    <span class="p">};</span>
</span>
    <span class="n">f</span><span class="p">();</span>
    <span class="c1">// x = 8 here</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id24">
<h3>33. C++ 中的成员初始化列表（构造函数初始化器列表）<a class="headerlink" href="#id24" title="永久链接至标题">¶</a></h3>
<p>类成员初始化的几种方式：</p>
<ul>
<li><p>方式一（构造函数中初始化）</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_Name</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
<span class="hll">        <span class="n">m_Name</span> <span class="o">=</span> <span class="s">&quot;Unknown&quot;</span><span class="p">;</span>
</span>    <span class="p">}</span>

    <span class="n">Entity</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span>
    <span class="p">{</span>
<span class="hll">        <span class="n">m_Name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
</span>    <span class="p">}</span>

    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">GetName</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_Name</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">entity</span><span class="p">;</span>
    <span class="n">Entity</span> <span class="n">entity2</span><span class="p">(</span><span class="s">&quot;Cherno&quot;</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">entity</span><span class="p">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>  <span class="c1">// output will be &quot;Unknown&quot;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">entity2</span><span class="p">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// output will be &quot;Cherno&quot;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>方式二（成员初始化列表）</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_Name</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">()</span>
<span class="hll">        <span class="o">:</span> <span class="n">m_Name</span><span class="p">(</span><span class="s">&quot;Unknown&quot;</span><span class="p">)</span>
</span>    <span class="p">{</span>
    <span class="p">}</span>

    <span class="n">Entity</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span>
<span class="hll">        <span class="o">:</span> <span class="n">m_Name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span>    <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">GetName</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_Name</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">entity</span><span class="p">;</span>
    <span class="n">Entity</span> <span class="n">entity2</span><span class="p">(</span><span class="s">&quot;Cherno&quot;</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">entity</span><span class="p">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>  <span class="c1">// output will be &quot;Unknown&quot;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">entity2</span><span class="p">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// output will be &quot;Cherno&quot;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>当有多个成员变量的时候，注意成员初始化列表中的顺序需要与它们定义的顺序保持一
致，否则可能会导致某些编译器报错，这是因为类中成员变量初始化总是按照它们在类
中出现的先后顺序确定的。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_Name</span><span class="p">;</span>
</span><span class="hll">    <span class="kt">int</span> <span class="n">m_Score</span><span class="p">;</span>
</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">()</span>
<span class="hll">        <span class="o">:</span> <span class="n">m_Name</span><span class="p">(</span><span class="s">&quot;Unknown&quot;</span><span class="p">),</span> <span class="n">m_Score</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span>    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
<p>为什么需要成员初始化列表？</p>
<blockquote>
<div><ul>
<li><p>避免额外无意义的初始化</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_Name</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">m_Score</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
<span class="hll">    <span class="n">Entity</span><span class="p">()</span>
</span>        <span class="o">:</span> <span class="n">m_Score</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">// without [ m_Name(&quot;Unknown&quot;) ] here</span>
<span class="hll">    <span class="p">{</span>
</span>        <span class="n">m_Name</span> <span class="o">=</span> <span class="s">&quot;Unknown&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
<p>上面的代码中，我们没有在成员初始化列表中对 <code class="docutils literal notranslate"><span class="pre">m_Name</span></code> 成员进行初始化，而
是将其初始化代码添加到构造函数体内部。这会导致 <code class="docutils literal notranslate"><span class="pre">m_Name</span></code> 进行两次初始化。
第一次是默认的，第二次是在构造函数体中我们编码写的。</p>
</li>
<li><p>演示代码</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span>  <span class="nc">Example</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="hll">    <span class="n">Example</span><span class="p">()</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Created Example !&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span>
<span class="hll">    <span class="n">Example</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Created Example With &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="p">};</span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">Example</span> <span class="n">m_Example</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
<span class="hll">    <span class="n">Entity</span><span class="p">()</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">m_Example</span> <span class="o">=</span> <span class="n">Example</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">entity</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>将会输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Created Example !
Created Example With 8!
</pre></div>
</div>
<p>如果我们使用成员初始化列表：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span>  <span class="nc">Example</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Example</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Created Example !&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Example</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Created Example With &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">Example</span> <span class="n">m_Example</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">()</span>
<span class="hll">        <span class="o">:</span> <span class="n">m_Example</span><span class="p">(</span><span class="n">Example</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span> <span class="c1">// or : m_Example(8)</span>
</span>    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">entity</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出将会是：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Created Example With 8!
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id25">
<h3>34. 三元运算符<a class="headerlink" href="#id25" title="永久链接至标题">¶</a></h3>
<p>略。</p>
</div>
<div class="section" id="id26">
<h3>35. C++ 中如何创建并初始化对象<a class="headerlink" href="#id26" title="永久链接至标题">¶</a></h3>
<p>C++ 中对像的创建主要有两种，主要根据对象在内存中的创建的位置进行分类，栈中 和 堆中。
栈中的对象的生命周期在离开其作用域后结束，而堆中的对象的生命周期将由编程人员决定。</p>
<p>栈通常不会很大，因此如果需要创建大量的对象的时候，考虑在堆中创建。</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">new</span></code> 关键字创建的对象在堆中，注意使用 <code class="docutils literal notranslate"><span class="pre">delete</span></code> 删除堆中分配的内存。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_Name</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">()</span> <span class="o">:</span> <span class="n">m_Name</span><span class="p">(</span><span class="s">&quot;Unknown&quot;</span><span class="p">)</span> <span class="p">{}</span>
    <span class="n">Entity</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span> <span class="o">:</span> <span class="n">m_Name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{}</span>

    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">GetName</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_Name</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="n">Entity</span> <span class="n">entity1</span><span class="p">(</span><span class="s">&quot;Cherno&quot;</span><span class="p">);</span>               <span class="c1">// stack</span>
</span><span class="hll">    <span class="n">Entity</span><span class="o">*</span> <span class="n">entity2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="p">(</span><span class="s">&quot;Cherno&quot;</span><span class="p">);</span> <span class="c1">// heap</span>
</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">entity1</span><span class="p">.</span><span class="n">GetName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="o">*</span><span class="n">entity2</span><span class="p">).</span><span class="n">GetName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">entity2</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span>
<span class="hll">    <span class="k">delete</span> <span class="n">entity2</span><span class="p">;</span>
</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="c-new">
<h3>36. C++ 中的 NEW 关键字<a class="headerlink" href="#c-new" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">new</span></code> 关键字除了寻找恰当大小的内存以存储目标对象，还会进行构造函数的调用。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_Name</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">()</span> <span class="o">:</span> <span class="n">m_Name</span><span class="p">(</span><span class="s">&quot;Unknown&quot;</span><span class="p">)</span> <span class="p">{}</span>
    <span class="n">Entity</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span> <span class="o">:</span> <span class="n">m_Name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{}</span>

    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">GetName</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_Name</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class="hll">    <span class="kt">int</span><span class="o">*</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">;</span>
</span><span class="hll">    <span class="kt">int</span><span class="o">*</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
</span>
<span class="hll">    <span class="n">Entity</span><span class="o">*</span> <span class="n">entity1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="p">;</span> <span class="c1">// or new Entity();</span>
</span><span class="hll">    <span class="n">Entity</span><span class="o">*</span> <span class="n">entity2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
</span><span class="hll">    <span class="c1">// Entity* entity2 = new(c) Entity[50]; // 指定在哪里创建对象</span>
</span>
<span class="hll">    <span class="k">delete</span> <span class="n">b</span><span class="p">;</span>
</span><span class="hll">    <span class="k">delete</span><span class="p">[]</span> <span class="n">c</span><span class="p">;</span>
</span><span class="hll">    <span class="k">delete</span> <span class="n">entity1</span><span class="p">;</span>
</span><span class="hll">    <span class="k">delete</span><span class="p">[]</span> <span class="n">entity2</span><span class="p">;</span>
</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="c-explict">
<h3>37. C++ 中的隐式转换和 Explict 关键字<a class="headerlink" href="#c-explict" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>隐式类型转换</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_Name</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">m_Age</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">(</span><span class="kt">int</span> <span class="n">age</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">m_Name</span><span class="p">(</span><span class="s">&quot;Unknown&quot;</span><span class="p">),</span> <span class="n">m_Age</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="p">{}</span>

    <span class="n">Entity</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">m_Name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">m_Age</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>

    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">GetName</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_Name</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">Print</span><span class="p">(</span><span class="k">const</span> <span class="n">Entity</span><span class="o">&amp;</span> <span class="n">entity</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="n">Entity</span> <span class="n">a1</span><span class="p">(</span><span class="s">&quot;Cherno&quot;</span><span class="p">);</span>
</span><span class="hll">    <span class="n">Entity</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">Entity</span><span class="p">(</span><span class="s">&quot;Cherno&quot;</span><span class="p">);</span>
</span><span class="hll">    <span class="n">Entity</span> <span class="n">a3</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">&quot;Cherno&quot;</span><span class="p">);</span> <span class="c1">// only use &quot;Cherno&quot; is ok in tutorial video</span>
</span>
<span class="hll">    <span class="n">Entity</span> <span class="n">b2</span><span class="p">(</span><span class="mi">22</span><span class="p">);</span>
</span><span class="hll">    <span class="n">Entity</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">Entity</span><span class="p">(</span><span class="mi">22</span><span class="p">);</span>
</span><span class="hll">    <span class="n">Entity</span> <span class="n">b3</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
</span>
<span class="hll">    <span class="n">Print</span><span class="p">(</span><span class="mi">22</span><span class="p">);</span>              <span class="c1">// 如果存在 Print(int) 前面的函数，则会调用这个更匹配的</span>
</span><span class="hll">    <span class="c1">// Print(&quot;Cherno&quot;);     // 这会失败因为仅允许一次隐式类型转化</span>
</span><span class="hll">    <span class="n">Print</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">&quot;Cherno&quot;</span><span class="p">));</span>
</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>explicit 关键字</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">m_Age</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
<span class="hll">    <span class="k">explicit</span> <span class="n">Entity</span><span class="p">(</span><span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="o">:</span> <span class="n">m_Age</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="p">{}</span>
</span><span class="p">};</span>

<span class="kt">void</span> <span class="nf">Print</span><span class="p">(</span><span class="k">const</span> <span class="n">Entity</span><span class="o">&amp;</span> <span class="n">entity</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">b2</span><span class="p">(</span><span class="mi">22</span><span class="p">);</span>
    <span class="n">Entity</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">Entity</span><span class="p">(</span><span class="mi">22</span><span class="p">);</span>
<span class="hll">    <span class="c1">// Entity b3 = 22;  // this will be fail</span>
</span>
<span class="hll">    <span class="c1">// Print(22);       // this will be fail</span>
</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
<p>C++ 中只会进行一次隐式类型转换，不会进行多次隐式类型转换。</p>
</div>
<div class="section" id="id27">
<h3>38. C++ 中的操作符和操作符重载<a class="headerlink" href="#id27" title="永久链接至标题">¶</a></h3>
<p>C++ 中的操作符仅仅是一个函数。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">struct</span>  <span class="n">Vector2</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>

    <span class="n">Vector2</span><span class="p">(</span><span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y</span><span class="p">)</span>
        <span class="o">:</span><span class="n">x</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="p">{}</span>

<span class="hll">    <span class="n">Vector2</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span><span class="hll">    <span class="p">}</span>
</span>
<span class="hll">    <span class="n">Vector2</span> <span class="n">Add</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="k">return</span> <span class="o">*</span><span class="k">this</span> <span class="o">+</span> <span class="n">other</span><span class="p">;</span> <span class="c1">// or return operator+(other);</span>
</span><span class="hll">    <span class="p">}</span>
</span>
<span class="hll">    <span class="n">Vector2</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span><span class="hll">    <span class="p">}</span>
</span>
<span class="hll">    <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span>
<span class="hll">    <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="k">this</span> <span class="o">==</span> <span class="n">other</span><span class="p">);</span><span class="c1">// or return !operator==(other);</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="p">};</span>

<span class="hll"><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">    <span class="n">stream</span> <span class="o">&lt;&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">stream</span><span class="p">;</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Vector2</span> <span class="n">positon</span><span class="p">(</span><span class="mf">4.0f</span><span class="p">,</span> <span class="mf">4.0f</span><span class="p">);</span>
    <span class="n">Vector2</span> <span class="nf">speed</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span> <span class="mf">1.5f</span><span class="p">);</span>
    <span class="n">Vector2</span> <span class="nf">powerup</span><span class="p">(</span><span class="mf">1.1f</span><span class="p">,</span> <span class="mf">1.1f</span><span class="p">);</span>

<span class="hll">    <span class="n">Vector2</span> <span class="n">result1</span> <span class="o">=</span> <span class="n">positon</span> <span class="o">+</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">powerup</span><span class="p">;</span>
</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">result1</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="c-this">
<h3>39. C++ 中的 this 关键字<a class="headerlink" href="#c-this" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>

    <span class="n">Entity</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">{</span>
<span class="hll">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
</span><span class="hll">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
</span>    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id28">
<h3>40. C++ 中的对象生命周期<a class="headerlink" href="#id28" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>作用域（scope）</p>
<blockquote>
<div><ul>
<li><p>函数作用域</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
<span class="hll"><span class="p">{</span>
</span><span class="hll">    <span class="c1">// code here</span>
</span><span class="hll"><span class="p">}</span>
</span></pre></div>
</td></tr></table></div>
</li>
<li><p>空作用域</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="p">{</span>
</span>    <span class="c1">// code here</span>
<span class="hll"><span class="p">}</span>
</span></pre></div>
</td></tr></table></div>
</li>
<li><p>类作用域</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Entity Created!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">~</span><span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Entity Destoried!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">Entity</span> <span class="n">e</span><span class="p">;</span>   <span class="c1">// output will be &quot;Entity Created!&quot;</span>
</span><span class="hll">    <span class="p">}</span>               <span class="c1">// output will be &quot;Entity Destoried!&quot;</span>
</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>上面代码中的 <code class="docutils literal notranslate"><span class="pre">e</span></code> 对象是在 <strong>栈</strong> 空间中创建的，在其作用域结束时（第
21 行）由于栈空间中其内存的释放，该对象被销毁，因此其析构函数被调用。</p>
<p>与上面的代码不同的是，下面代码中的 <code class="docutils literal notranslate"><span class="pre">e</span></code> 指针指向了分配在堆中的对象，
在其作用域结束时（第 21 行）由于栈空间中其内存的释放，该 <strong>指针</strong> 被
销毁， <em>但指针所指向的堆中的对象并没有被销毁</em> ，相反该堆中的对象在程序
终止后由操作系统将其销毁。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Entity Created!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">~</span><span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Entity Destoried!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">Entity</span><span class="o">*</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="p">;</span>   <span class="c1">// output will be &quot;Entity Created!&quot;</span>
</span><span class="hll">    <span class="p">}</span>
</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>注意事项：</p>
<blockquote>
<div><p>下面代码 <code class="docutils literal notranslate"><span class="pre">int*</span> <span class="pre">CreateArray()</span></code> 函数中，由于 <code class="docutils literal notranslate"><span class="pre">array</span></code> 数组是在栈
中创建的，因此在该函数的作用域结束后，该 <code class="docutils literal notranslate"><span class="pre">array</span></code> 数组对象将被销
毁，因此 <code class="docutils literal notranslate"><span class="pre">main</span></code> 函数中的指针 <code class="docutils literal notranslate"><span class="pre">a</span></code> 将不会获得一个有效的数组（该
指针指向的数组在 <code class="docutils literal notranslate"><span class="pre">CreateArray</span></code> 方法返回后就被销毁了，虽然该指针
还指向之前的那个地址）：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="kt">int</span><span class="o">*</span> <span class="nf">CreateArray</span><span class="p">()</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">    <span class="kt">int</span> <span class="n">array</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">array</span><span class="p">;</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="kt">int</span><span class="o">*</span> <span class="n">a</span> <span class="o">=</span> <span class="n">CreateArray</span><span class="p">();</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>可以在 <code class="docutils literal notranslate"><span class="pre">int*</span> <span class="pre">CreateArray()</span></code> 函数中在堆中创建数组对象，这样在该
函数的作用域结束后，堆中的数组对象并不会被销毁，这样就可以在 <code class="docutils literal notranslate"><span class="pre">main</span></code>
函数中获得预期的数组对象：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="o">*</span> <span class="nf">CreateArray</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="kt">int</span><span class="o">*</span> <span class="n">array</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">array</span><span class="p">;</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="kt">int</span><span class="o">*</span> <span class="n">a</span> <span class="o">=</span> <span class="n">CreateArray</span><span class="p">();</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>利用作用域创建智能指针：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Entity Created!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">~</span><span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Entity Destoried!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="hll"><span class="k">class</span>  <span class="nc">ScopedPtr</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll"><span class="k">private</span><span class="o">:</span>
</span><span class="hll">    <span class="n">Entity</span><span class="o">*</span> <span class="n">m_Ptr</span><span class="p">;</span>
</span><span class="hll"><span class="k">public</span><span class="o">:</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">ScopedPtr</span><span class="p">(</span><span class="n">Entity</span><span class="o">*</span> <span class="n">ptr</span><span class="p">)</span>
</span><span class="hll">        <span class="o">:</span><span class="n">m_Ptr</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="hll">    <span class="o">~</span><span class="n">ScopedPtr</span><span class="p">()</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="k">delete</span> <span class="n">m_Ptr</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="hll"><span class="p">};</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">{</span>
        <span class="n">Entity</span><span class="o">*</span> <span class="n">e1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="p">;</span>
    <span class="p">}</span>

<span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">ScopedPtr</span> <span class="n">e2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="p">;</span>  <span class="c1">// 隐式转换</span>
</span><span class="hll">    <span class="p">}</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Entity Created!
Entity Created!
Entity Destoried!
</pre></div>
</div>
</div></blockquote>
<p>Timer base on scope</p>
<p>Mutex lock base on scope</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id29">
<h3>41. C++ 中的智能指针<a class="headerlink" href="#id29" title="永久链接至标题">¶</a></h3>
<p>C++ 中的智能指针就是在使用 <code class="docutils literal notranslate"><span class="pre">new</span></code> 关键字分配内存后不需要你手动地去 <code class="docutils literal notranslate"><span class="pre">delete</span></code> 掉
这部分内存。</p>
<ol class="arabic">
<li><p>unique pointer (a kind of socped pointer)</p>
<p>unique pinter 不能复制</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="hll"><span class="cp">#include</span><span class="cpf">&lt;memory&gt;</span><span class="cp"></span>
</span>
<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Entity Created!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">~</span><span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Entity Destoried!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">Print</span><span class="p">()</span> <span class="p">{};</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">{</span>
<span class="hll">        <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span> <span class="n">entity1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span><span class="p">();</span>   <span class="c1">// or : std::unique_ptr&lt;Entity&gt; entity1(new Entity);</span>
</span>
<span class="hll">        <span class="c1">// std::unique_ptr&lt;Entity&gt; entity2 = entity1; // 这是不允许的</span>
</span>
<span class="hll">        <span class="n">entity1</span><span class="o">-&gt;</span><span class="n">Print</span><span class="p">();</span>
</span>    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Entity Created!
Entity Created!
Entity Destoried!
Entity Destoried!
</pre></div>
</div>
</li>
<li><p>shared pointer(based on reference counting)</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;memory&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Entity Created!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">~</span><span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Entity Destoried!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">Print</span><span class="p">()</span> <span class="p">{};</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span> <span class="n">entity1</span><span class="p">;</span>
</span><span class="hll">        <span class="p">{</span>
</span><span class="hll">            <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span> <span class="n">entity2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span><span class="p">();</span>   <span class="c1">// or : std::shared_ptr&lt;Entity&gt; entity2 (new Entity);</span>
</span><span class="hll">                                                                            <span class="c1">// 引用计数为一</span>
</span><span class="hll">            <span class="n">entity1</span> <span class="o">=</span> <span class="n">entity2</span><span class="p">;</span>      <span class="c1">// 引用计数加一</span>
</span><span class="hll">        <span class="p">}</span>   <span class="c1">//  entity2 的作用域结束，引用计数减一</span>
</span><span class="hll">    <span class="p">}</span>       <span class="c1">//  entity1 的作用域结束，引用计数减一，对象被销毁</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>将 <cite>shared_ptr</cite> 拷贝给 <cite>weak_ptr</cite> ，不会增加 <cite>shared_ptr</cite> 的引用计数：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;memory&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Entity Created!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">~</span><span class="n">Entity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Entity Destoried!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">Print</span><span class="p">()</span> <span class="p">{};</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">std</span><span class="o">::</span><span class="n">weak_ptr</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span> <span class="n">entity1</span><span class="p">;</span>
</span><span class="hll">        <span class="p">{</span>
</span><span class="hll">            <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span> <span class="n">entity2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span><span class="p">();</span>   <span class="c1">// or : std::shared_ptr&lt;Entity&gt; entity2 (new Entity);</span>
</span><span class="hll">                                                                            <span class="c1">// 引用计数为一</span>
</span><span class="hll">            <span class="n">entity1</span> <span class="o">=</span> <span class="n">entity2</span><span class="p">;</span>      <span class="c1">// 引用计数不变</span>
</span><span class="hll">        <span class="p">}</span>   <span class="c1">//  entity2 的作用域结束，引用计数减一，对象被销毁</span>
</span><span class="hll">    <span class="p">}</span>       <span class="c1">//  entity1 的作用域结束</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
</ol>
</div>
<div class="section" id="copying-and-copy-constructors-in-c">
<h3>42. Copying and Copy Constructors in C++<a class="headerlink" href="#copying-and-copy-constructors-in-c" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">String</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">m_Buffer</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">m_Size</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">String</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">string</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_Size</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
        <span class="n">m_Buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">m_Size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="n">m_Buffer</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">m_Size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

<span class="hll">    <span class="o">~</span><span class="n">String</span><span class="p">()</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="k">delete</span><span class="p">[]</span> <span class="n">m_Buffer</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="n">String</span><span class="o">&amp;</span> <span class="n">string</span><span class="p">);</span>
</span><span class="hll"><span class="p">};</span>
</span><span class="hll">
</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="n">String</span><span class="o">&amp;</span> <span class="n">string</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">stream</span> <span class="o">&lt;&lt;</span> <span class="n">string</span><span class="p">.</span><span class="n">m_Buffer</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">stream</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">String</span> <span class="n">string</span> <span class="o">=</span> <span class="s">&quot;Cherno&quot;</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">string</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// output will be &quot;Cherno&quot;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>我们进行一次复制操作：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">String</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">m_Buffer</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">m_Size</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="c1">//String(const String&amp; string) = delete; // use this to remove the default copy constructor</span>
    <span class="n">String</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">string</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_Size</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
        <span class="n">m_Buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">m_Size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="n">m_Buffer</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">m_Size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">~</span><span class="n">String</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">delete</span><span class="p">[]</span> <span class="n">m_Buffer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="n">String</span><span class="o">&amp;</span> <span class="n">string</span><span class="p">);</span>
<span class="p">};</span>

<span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="n">String</span><span class="o">&amp;</span> <span class="n">string</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">stream</span> <span class="o">&lt;&lt;</span> <span class="n">string</span><span class="p">.</span><span class="n">m_Buffer</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">stream</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="n">String</span> <span class="n">string</span> <span class="o">=</span> <span class="s">&quot;Cherno&quot;</span><span class="p">;</span>
</span>    <span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">string</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">string</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Cherno</span>
<span class="n">Cherno</span>
</pre></div>
</div>
<p>程序输出正确，然而当我们在命令行输出窗口中按下回车键，程序运行到 40 行时，程序将
崩溃。这是由于 C++ 中默认的复制操作底层实现是将类中的所有成员进行简单的复制，也
就是说在 <code class="docutils literal notranslate"><span class="pre">string</span></code> 和 <code class="docutils literal notranslate"><span class="pre">second</span></code> 对象中的成员 <code class="docutils literal notranslate"><span class="pre">m_Buffer</span></code> 和 <code class="docutils literal notranslate"><span class="pre">m_Size</span></code> 拥有相
同的值，程序运行到最后时，对象将会调用其析构函数，导致同一个 <code class="docutils literal notranslate"><span class="pre">m_Buffer</span></code> 值作为
参数被连续两次调用 <cite>delete[]</cite> ，这就是崩溃的原因。</p>
<p>按如下调整可解决该问题：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">String</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">m_Buffer</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">m_Size</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">String</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">string</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_Size</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
        <span class="n">m_Buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">m_Size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="n">m_Buffer</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">m_Size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

<span class="hll">    <span class="c1">//String(const String&amp; other) = delete; // use this to remove the default copy constructor</span>
</span><span class="hll">    <span class="n">String</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span>
</span><span class="hll">        <span class="o">:</span> <span class="n">m_Size</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">m_Size</span><span class="p">)</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;String Copied!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class="hll">        <span class="n">m_Buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">m_Size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span><span class="hll">        <span class="n">memcpy</span><span class="p">(</span><span class="n">m_Buffer</span><span class="p">,</span> <span class="n">other</span><span class="p">.</span><span class="n">m_Buffer</span><span class="p">,</span> <span class="n">m_Size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span><span class="hll">    <span class="p">}</span>
</span>
    <span class="kt">char</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">m_Buffer</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="o">~</span><span class="n">String</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">delete</span><span class="p">[]</span> <span class="n">m_Buffer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="n">String</span><span class="o">&amp;</span> <span class="n">string</span><span class="p">);</span>
<span class="p">};</span>

<span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="n">String</span><span class="o">&amp;</span> <span class="n">string</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">stream</span> <span class="o">&lt;&lt;</span> <span class="n">string</span><span class="p">.</span><span class="n">m_Buffer</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">stream</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">PrintString</span><span class="p">(</span><span class="n">String</span> <span class="n">string</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">string</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">String</span> <span class="n">string</span> <span class="o">=</span> <span class="s">&quot;Cherno&quot;</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">string</span><span class="p">;</span>

    <span class="n">PrintString</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
    <span class="n">PrintString</span><span class="p">(</span><span class="n">second</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出为：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>String Copied!
String Copied!
Cherno
String Copied!
Cherno
</pre></div>
</div>
<p>拷贝发生在 53，55，56 三处，其中 55，56 两行发生的拷贝可将 45 行代码调整如下解决：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="kt">void</span> <span class="n">PrintString</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span><span class="o">&amp;</span> <span class="n">string</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id30">
<h3>43. C++ 中的箭头（-&gt;）操作符<a class="headerlink" href="#id30" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>基础使用</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>

    <span class="kt">void</span> <span class="n">Print</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hello!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span> <span class="n">e</span><span class="p">;</span>
    <span class="n">e</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>

<span class="hll">    <span class="n">Entity</span><span class="o">*</span> <span class="n">ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">;</span>
</span><span class="hll">    <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">Print</span><span class="p">();</span>
</span><span class="hll">    <span class="p">(</span><span class="o">*</span><span class="n">ptr</span><span class="p">).</span><span class="n">Print</span><span class="p">();</span>
</span>
    <span class="n">Entity</span><span class="o">&amp;</span> <span class="n">entity</span> <span class="o">=</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>在 Scoped Pointer 中使用</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">Print</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hello!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">};</span>

<span class="k">class</span>  <span class="nc">ScopedPtr</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">Entity</span><span class="o">*</span> <span class="n">m_Ptr</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>

    <span class="n">ScopedPtr</span><span class="p">(</span><span class="n">Entity</span><span class="o">*</span> <span class="n">ptr</span><span class="p">)</span>
        <span class="o">:</span><span class="n">m_Ptr</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>
    <span class="o">~</span><span class="n">ScopedPtr</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">delete</span> <span class="n">m_Ptr</span><span class="p">;</span>
    <span class="p">}</span>

<span class="hll">    <span class="n">Entity</span><span class="o">*</span> <span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">m_Ptr</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Entity</span><span class="o">*</span> <span class="n">e1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="p">;</span>
    <span class="n">e1</span><span class="o">-&gt;</span><span class="n">Print</span><span class="p">();</span>
    <span class="k">delete</span> <span class="n">e1</span><span class="p">;</span>

<span class="hll">    <span class="n">ScopedPtr</span> <span class="n">e2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="p">;</span>
</span><span class="hll">    <span class="n">e2</span><span class="o">-&gt;</span><span class="n">Print</span><span class="p">();</span>
</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>获取成员在内存中的偏移</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">Vector3</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(((</span><span class="n">Vector3</span><span class="o">*</span><span class="p">)</span><span class="k">nullptr</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">);</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">offset</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>   <span class="c1">// output will be &quot;4&quot;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<div class="section" id="id31">
<h3>44. C++ 中的动态数组<a class="headerlink" href="#id31" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">std::vector&lt;Vertex&gt;</span> <span class="pre">vertices;</span></code> 还是 <code class="docutils literal notranslate"><span class="pre">std::vector&lt;Vertex*&gt;</span> <span class="pre">vertices;</span></code> ？</p>
<p>第一种是在栈空间中创建数组，在内存中是连续的，因此遍历的效率会好一些。但是如果需
要 resize 的话，就需要将整个数据拷贝到另一个更大的内存空间中，会有一定的开销。</p>
<p>第二种是则是在堆空间中创建数组，在内存中通常不是连续的，因此遍历的效率会差一些。
但是 resize 的时候会少一些拷贝的开销。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">Vertex</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vertex</span><span class="o">&amp;</span> <span class="n">vertex</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">stream</span> <span class="o">&lt;&lt;</span> <span class="n">vertex</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">vertex</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">vertex</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">stream</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="o">&gt;</span> <span class="n">vertices</span><span class="p">;</span>

    <span class="c1">// 添加元素</span>
    <span class="n">vertices</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span> <span class="p">});</span>
    <span class="n">vertices</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span> <span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span> <span class="p">});</span>

    <span class="c1">// 遍历元素</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">vertices</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">Vertex</span><span class="o">&amp;</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">vertices</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 移除元素</span>
    <span class="n">vertices</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">vertices</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

    <span class="c1">// 清除</span>
    <span class="n">vertices</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>std::vector 更像是是 array list</p>
</div>
<div class="section" id="c-std-vector">
<h3>45. C++ 中的 std-vector 使用优化<a class="headerlink" href="#c-std-vector" title="永久链接至标题">¶</a></h3>
<p>使用 <code class="docutils literal notranslate"><span class="pre">std::vector</span></code> 向里面 <code class="docutils literal notranslate"><span class="pre">push_back</span></code> 元素时，如果 vector 的 capcity 无法完
成此次添加的操作，则需要分配一个更大的内存空间以将新添加的元素容纳进来，并把原来
内存空间中的数据拷贝到新分配的空间中。在使用 <code class="docutils literal notranslate"><span class="pre">std::vector</span></code> 过程中，如何避免这
种元素数据的拷贝？</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">Vertex</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span>

    <span class="n">Vertex</span><span class="p">(</span><span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y</span><span class="p">,</span> <span class="kt">float</span> <span class="n">z</span><span class="p">)</span>
        <span class="o">:</span><span class="n">x</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">z</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

<span class="hll">    <span class="n">Vertex</span><span class="p">(</span><span class="k">const</span> <span class="n">Vertex</span><span class="o">&amp;</span> <span class="n">vertex</span><span class="p">)</span>
</span><span class="hll">        <span class="o">:</span><span class="n">x</span><span class="p">(</span><span class="n">vertex</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">vertex</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">z</span><span class="p">(</span><span class="n">vertex</span><span class="p">.</span><span class="n">z</span><span class="p">)</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Copied!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="o">&gt;</span> <span class="n">vertices</span><span class="p">;</span>

<span class="hll">    <span class="n">vertices</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
</span><span class="hll">    <span class="n">vertices</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Vertex</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
</span><span class="hll">    <span class="n">vertices</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Vertex</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">));</span>
</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Copied!
Copied!
Copied!
Copied!
Copied!
Copied!
</pre></div>
</div>
<p>在上面的代码中，有两种类型的数据拷贝：</p>
<blockquote>
<div><ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">vertices.push_back(Vertex(1,</span> <span class="pre">2,</span> <span class="pre">3));</span></code> 这里调用 <cite>vector</cite> 的 <cite>push_back</cite>
时，<code class="docutils literal notranslate"><span class="pre">Vertex(1,</span> <span class="pre">2,</span> <span class="pre">3</span></code> 会在 <code class="docutils literal notranslate"><span class="pre">mian</span></code> 方法所在的 <cite>stack frame</cite> 中进行构建，
然后在方法调用时拷贝到 <cite>vector</cite> 对象所在的 <cite>stack frame</cite> ；</p>
<blockquote>
<div><p>可以通过调用 <code class="docutils literal notranslate"><span class="pre">vertices.push_back</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">vertices.push_back</span></code> 避
免这种类型的拷贝：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="n">vertices</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span><span class="hll"><span class="n">vertices</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</span><span class="hll"><span class="n">vertices</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
</span></pre></div>
</td></tr></table></div>
<p>输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Copied!
Copied!
Copied!
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">emplace_back</span></code> 方法中传递的是构建目标对象的参数列表，而不是已构建好
的对象本身。</p>
</div></blockquote>
</li>
<li><p>上面代码创建的 <cite>vertices</cite> 对象默认的 <cite>capacity</cite> 是 <code class="docutils literal notranslate"><span class="pre">1</span></code> ，因此添加第二个
元素的时候就需要把之前的元素拷贝到新分配的更大的内存空间中。</p>
<blockquote>
<div><p>可以通过调用 <code class="docutils literal notranslate"><span class="pre">vertices.reserve(3);</span></code> 来告诉 vector 准备创建可容纳 3
个元素的的对象：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="o">&gt;</span> <span class="n">vertices</span><span class="p">;</span>

<span class="hll">    <span class="n">vertices</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span class="hll">    <span class="n">vertices</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span><span class="hll">    <span class="n">vertices</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</span><span class="hll">    <span class="n">vertices</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>这时将不会有任何输出，即避免了之前两种拷贝的发生。</p>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="id32">
<h3>46. C++ 中库的使用（静态链接）<a class="headerlink" href="#id32" title="永久链接至标题">¶</a></h3>
<p>includes: a bounch of header files.</p>
<p>libraries: pre-compiled binaries, static or dynamic.</p>
<p>静态链接效率通常会好一些。</p>
<p>visual studio 中设置：</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>include directories:</p></li>
</ol>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Properties</span> <span class="pre">-&gt;</span> <span class="pre">Configuration</span> <span class="pre">Properties</span> <span class="pre">-&gt;</span> <span class="pre">C/C++</span> <span class="pre">-&gt;</span> <span class="pre">General</span> <span class="pre">-&gt;</span> <span class="pre">Adding</span> <span class="pre">include</span> <span class="pre">Directories</span></code></p>
</div></blockquote>
<ol class="arabic" start="2">
<li><p>include directories:</p>
<p><code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Properties</span> <span class="pre">-&gt;</span> <span class="pre">Configuration</span> <span class="pre">Properties</span> <span class="pre">-&gt;</span> <span class="pre">Linker</span> <span class="pre">-&gt;</span> <span class="pre">General</span> <span class="pre">-&gt;</span> <span class="pre">Additional</span> <span class="pre">Library</span> <span class="pre">Directories</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Properties</span> <span class="pre">-&gt;</span> <span class="pre">Configuration</span> <span class="pre">Properties</span> <span class="pre">-&gt;</span> <span class="pre">Linker</span> <span class="pre">-&gt;</span> <span class="pre">Input</span> <span class="pre">-&gt;</span> <span class="pre">Additional</span> <span class="pre">Dependencies</span></code> : <code class="docutils literal notranslate"><span class="pre">glfw3.lib</span></code></p>
<p>如果设置了第一项，第二项中只填入库文件的相对路径就行，否则需要在第二项中填入完整的库文件路径。</p>
</li>
</ol>
</div></blockquote>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="hll"><span class="c1">// #include &lt;GLFE/glfw3.h&gt;</span>
</span><span class="hll"><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="kt">int</span> <span class="n">glfwInit</span><span class="p">();</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="kt">int</span> <span class="n">a</span>  <span class="o">=</span> <span class="n">glfwInit</span><span class="p">();</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id33">
<h3>47. C++ 中使用动态链接库<a class="headerlink" href="#id33" title="永久链接至标题">¶</a></h3>
<p>visual studio 中设置：</p>
<blockquote>
<div><ol class="arabic">
<li><p>include directories:</p>
<p><code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Properties</span> <span class="pre">-&gt;</span> <span class="pre">Configuration</span> <span class="pre">Properties</span> <span class="pre">-&gt;</span> <span class="pre">C/C++</span> <span class="pre">-&gt;</span> <span class="pre">General</span> <span class="pre">-&gt;</span> <span class="pre">Adding</span> <span class="pre">include</span> <span class="pre">Directories</span></code></p>
</li>
<li><p>include directories:</p>
<p><code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Properties</span> <span class="pre">-&gt;</span> <span class="pre">Configuration</span> <span class="pre">Properties</span> <span class="pre">-&gt;</span> <span class="pre">Linker</span> <span class="pre">-&gt;</span> <span class="pre">General</span> <span class="pre">-&gt;</span> <span class="pre">Additional</span> <span class="pre">Library</span> <span class="pre">Directories</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Properties</span> <span class="pre">-&gt;</span> <span class="pre">Configuration</span> <span class="pre">Properties</span> <span class="pre">-&gt;</span> <span class="pre">Linker</span> <span class="pre">-&gt;</span> <span class="pre">Input</span> <span class="pre">-&gt;</span> <span class="pre">Additional</span> <span class="pre">Dependencies</span></code> : <code class="docutils literal notranslate"><span class="pre">glfw3dll.lib</span></code> (注意保证 <code class="docutils literal notranslate"><span class="pre">glfw3dll.lib</span></code> 与 <code class="docutils literal notranslate"><span class="pre">glfw3.dll</span></code> 是同时编译的 )</p>
<p>如果设置了第一项，第二项中只填入库文件的相对路径就行，否则需要在第二项中填入完整的库文件路径。</p>
<p><strong>运行程序时，需要把 ``glfw3.dll`` 放到程序所在的路径下。</strong></p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="id34">
<h3>48. 创建和使用 C++ 库<a class="headerlink" href="#id34" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>Visual Studio 中创建一个空的 C++ 项目 <code class="docutils literal notranslate"><span class="pre">Game</span></code> ; 然后再添加一个空的 C++ 项目 <code class="docutils literal notranslate"><span class="pre">Engine</span></code> 。</p></li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">Game</span></code> 项目的 <cite>Project Properties -&gt; Configuration Properties -&gt; General -&gt; General Properties -&gt; Configuration Type</cite> 选项中设置为 <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">(.exe)</span></code> 。</p></li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">Engine</span></code> 项目的 <cite>Project Properties -&gt; Configuration Properties -&gt; General -&gt; General Properties -&gt; Configuration Type</cite> 选项中设置为 <code class="docutils literal notranslate"><span class="pre">Static</span> <span class="pre">library</span> <span class="pre">(.lib)</span></code> 。</p></li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">Game</span></code> 项目的 <code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Properties</span> <span class="pre">-&gt;</span> <span class="pre">Configuration</span> <span class="pre">Properties</span> <span class="pre">-&gt;</span> <span class="pre">C/C++</span> <span class="pre">-&gt;</span> <span class="pre">General</span> <span class="pre">-&gt;</span> <span class="pre">Adding</span> <span class="pre">include</span> <span class="pre">Directories</span></code> 选项中添加 <code class="docutils literal notranslate"><span class="pre">Engine</span></code> 项目中头文件所在的路径。（为了编译通过）</p></li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">Game</span></code> 项目的引用中添加对 <code class="docutils literal notranslate"><span class="pre">Engine</span></code> 项目的引用。（为了链接通过）</p></li>
</ol>
</div>
<div class="section" id="id35">
<h3>49. C++ 中如何处理多个返回值<a class="headerlink" href="#id35" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">结构体</span></code> <code class="docutils literal notranslate"><span class="pre">以引用的方式传递待返回的数据到方法中</span></code> <code class="docutils literal notranslate"><span class="pre">std::tuple</span></code> <code class="docutils literal notranslate"><span class="pre">std::pair</span></code></p>
</div>
<div class="section" id="id36">
<h3>50. C++ 中的模板<a class="headerlink" href="#id36" title="永久链接至标题">¶</a></h3>
<p>C++ 中的模板有些类似于 CSharp 中的泛型，模板在编译的时候被“展开”，而宏则是
在此之前进行“展开”（简单的文本替换）。</p>
<p>没有使用模板的代码：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">Print</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">Print</span><span class="p">(</span><span class="kt">float</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">Print</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Print</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="n">Print</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">);</span>
    <span class="n">Print</span><span class="p">(</span><span class="mf">5.5f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>使用模板后的代码：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>    <span class="c1">// or : template&lt;class T&gt;</span>
</span><span class="hll"><span class="kt">void</span> <span class="n">Print</span><span class="p">(</span><span class="n">T</span> <span class="n">value</span><span class="p">)</span>
</span><span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="n">Print</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>           <span class="c1">// or : Print&lt;int&gt;(5);</span>
</span><span class="hll">    <span class="n">Print</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">);</span>     <span class="c1">// or : Print&lt;std::string&gt;(&quot;Hello&quot;);</span>
</span><span class="hll">    <span class="n">Print</span><span class="p">(</span><span class="mf">5.5f</span><span class="p">);</span>        <span class="c1">// or : Print&lt;float&gt;(5.5f);</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>编译时，编译器会根据代码的情况将模板生成相应的代码，然后进行编译。比如上面的
代码中，编译器就会生成3个函数 <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">Print(int</span> <span class="pre">value)</span></code> 、 <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">Print(float</span> <span class="pre">value)</span></code> 和 <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">Print(std::string</span> <span class="pre">value)</span></code> 。
如果代码中没有任何调用模板的代码，则编译器不会生成相应的函数。当不需要编译器
生成函数的时候，如果模板中的代码有错误，有些编译器是不会报错的。</p>
<p>示例：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="o">&gt;</span>
</span><span class="k">class</span> <span class="nc">Array</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="hll">    <span class="n">T</span> <span class="n">m_Array</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">GetSize</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">N</span><span class="p">;</span> <span class="p">};</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="n">Array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">5</span><span class="o">&gt;</span> <span class="n">array</span><span class="p">;</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">array</span><span class="p">.</span><span class="n">GetSize</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</div>
<div class="section" id="id37">
<h3>51. C++ 中的栈和堆<a class="headerlink" href="#id37" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id38">
<h3>52. C++ 中的宏<a class="headerlink" href="#id38" title="永久链接至标题">¶</a></h3>
<p>模板在编译的时候被“展开”，而宏则是在此之前进行“展开”（简单的文本替换）。</p>
<ul>
<li><p>示例代码一：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="cp">#define WAIT std::cin.get()</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="n">WAIT</span><span class="p">;</span>
</span><span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>示例代码二（带参数）：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="cp">#define Log(x) std::cout &lt;&lt; x &lt;&lt; std::endl</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="n">Log</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">);</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>示例代码三（条件编译）：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="cp">#ifdef DEBUG</span>
</span><span class="hll"><span class="cp">#define Log(x) std::cout &lt;&lt; x &lt;&lt; std::endl</span>
</span><span class="hll"><span class="cp">#else</span>
</span><span class="hll"><span class="cp">#define Log(x)</span>
</span><span class="hll"><span class="cp">#endif</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Log</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>示例代码四（条件编译）：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="cp">#define DEBUGLevel  1</span>
</span>
<span class="hll"><span class="cp">#if DEBUGLevel == 1</span>
</span><span class="cp">#define Log(x) std::cout &lt;&lt; x &lt;&lt; std::endl</span>
<span class="cp">#else</span>
<span class="cp">#define Log(x)</span>
<span class="cp">#endif</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Log</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>示例代码四（换行）：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="hll"><span class="cp">#define MAIN int main() \</span>
</span><span class="hll"><span class="cp">{\</span>
</span><span class="hll"><span class="cp">    std::cin.get(); \</span>
</span><span class="hll"><span class="cp">}</span>
</span>
<span class="hll"><span class="n">MAIN</span>
</span></pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<div class="section" id="c-auto">
<h3>53. C++ 中的 auto 关键字<a class="headerlink" href="#c-auto" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id39">
<h3>54. C++ 中的静态数组<a class="headerlink" href="#id39" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id40">
<h3>55. C++ 中的函数指针<a class="headerlink" href="#id40" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>函数指针的基本使用：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">Hello1</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hello!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">Hello2</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 11. auto</span>
<span class="hll">    <span class="k">auto</span> <span class="n">func11</span> <span class="o">=</span> <span class="n">Hello1</span><span class="p">;</span>
</span>
    <span class="c1">// 12. 指定类型</span>
<span class="hll">    <span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="n">func12</span><span class="p">)()</span> <span class="o">=</span> <span class="n">Hello1</span><span class="p">;</span>
</span>
    <span class="c1">// 13. typedef 类似于 C# 中的 delegate</span>
<span class="hll">    <span class="k">typedef</span> <span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="n">HelloFunc1</span><span class="p">)();</span>
</span><span class="hll">    <span class="n">HelloFunc1</span> <span class="n">func13</span> <span class="o">=</span> <span class="n">Hello1</span><span class="p">;</span>
</span>
    <span class="c1">// 14. lambda</span>
    <span class="k">auto</span> <span class="n">func14</span> <span class="o">=</span> <span class="p">[]()</span> <span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hello!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="p">};</span>

    <span class="n">func11</span><span class="p">();</span>
    <span class="n">func12</span><span class="p">();</span>
    <span class="n">func13</span><span class="p">();</span>
    <span class="n">func14</span><span class="p">();</span>

    <span class="c1">// 21. auto</span>
<span class="hll">    <span class="k">auto</span> <span class="n">func21</span> <span class="o">=</span> <span class="n">Hello2</span><span class="p">;</span>
</span>
    <span class="c1">// 22. 指定类型</span>
<span class="hll">    <span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="n">func22</span><span class="p">)(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span> <span class="n">message</span><span class="p">)</span> <span class="o">=</span> <span class="n">Hello2</span><span class="p">;</span>
</span>
    <span class="c1">// 23. typedef 类似于 C# 中的 delegate</span>
<span class="hll">    <span class="k">typedef</span> <span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="n">HelloFunc2</span><span class="p">)(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">message</span><span class="p">);</span>
</span><span class="hll">    <span class="n">HelloFunc2</span> <span class="n">func23</span> <span class="o">=</span> <span class="n">Hello2</span><span class="p">;</span>
</span>
    <span class="c1">// 24. lambda</span>
<span class="hll">    <span class="k">auto</span> <span class="n">func24</span> <span class="o">=</span> <span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="p">};</span>
</span>
    <span class="n">func21</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">);</span>
    <span class="n">func22</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">);</span>
    <span class="n">func23</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">);</span>
    <span class="n">func24</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</li>
<li><p>实际使用场景：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="hll"><span class="kt">void</span> <span class="nf">HandleVector</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">,</span> <span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)(</span><span class="kt">int</span><span class="p">))</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="nl">item</span> <span class="p">:</span> <span class="n">data</span><span class="p">)</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">func</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span> <span class="p">};</span>
<span class="hll">    <span class="n">HandleVector</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">print</span><span class="p">);</span>
</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="c-lambda">
<h3>56. C++ 中的 Lambda 表达式<a class="headerlink" href="#c-lambda" title="永久链接至标题">¶</a></h3>
<p>Lambda 表达式主要是用于创建匿名函数，通常在 C++ 中使用函数指针的地方都可以
使用 Lambda 表达式。</p>
<p>比如上一节 <a class="reference internal" href="#id40"><span class="std std-ref">55. C++ 中的函数指针</span></a> 中的示例代码可以做如下修改：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">HandleVector</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">,</span> <span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)(</span><span class="kt">int</span><span class="p">))</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="nl">item</span> <span class="p">:</span> <span class="n">data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">func</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span> <span class="p">};</span>
<span class="hll">    <span class="n">HandleVector</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[](</span><span class="kt">int</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="p">;</span> <span class="p">});</span>
</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span>
</pre></div>
</div>
</div></blockquote>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">Print1</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;value outside labmda: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">Print2</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;value in labmda: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="hll">    <span class="k">auto</span> <span class="n">func1</span> <span class="o">=</span> <span class="p">[</span><span class="o">=</span><span class="p">]()</span> <span class="p">{</span> <span class="n">Print2</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="p">};</span>
</span><span class="hll">    <span class="k">auto</span> <span class="n">func2</span> <span class="o">=</span> <span class="p">[</span><span class="o">=</span><span class="p">]()</span> <span class="k">mutable</span>
</span>    <span class="p">{</span>
        <span class="n">a</span><span class="o">++</span><span class="p">;</span>
        <span class="n">Print2</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
    <span class="p">};</span>

<span class="hll">    <span class="k">auto</span> <span class="n">func3</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="o">&amp;</span><span class="n">b</span><span class="p">]()</span> <span class="k">mutable</span>
</span>    <span class="p">{</span>
        <span class="n">a</span><span class="o">++</span><span class="p">;</span>
        <span class="n">b</span><span class="o">++</span><span class="p">;</span>
        <span class="n">Print2</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
        <span class="n">Print2</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
    <span class="p">};</span>

<span class="hll">    <span class="k">auto</span> <span class="n">func4</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">]()</span>
</span>    <span class="p">{</span>
        <span class="n">a</span><span class="o">++</span><span class="p">;</span>
        <span class="n">b</span><span class="o">++</span><span class="p">;</span>
        <span class="n">Print2</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
        <span class="n">Print2</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="n">func1</span><span class="p">();</span>
    <span class="n">Print1</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>

    <span class="n">func2</span><span class="p">();</span>
    <span class="n">Print1</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>

    <span class="n">func3</span><span class="p">();</span>
    <span class="n">Print1</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
    <span class="n">Print1</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>

    <span class="n">func4</span><span class="p">();</span>
    <span class="n">Print1</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
    <span class="n">Print1</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="ow">in</span> <span class="n">labmda</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">value</span> <span class="n">outside</span> <span class="n">labmda</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">value</span> <span class="ow">in</span> <span class="n">labmda</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">value</span> <span class="n">outside</span> <span class="n">labmda</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">value</span> <span class="ow">in</span> <span class="n">labmda</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">value</span> <span class="ow">in</span> <span class="n">labmda</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">value</span> <span class="n">outside</span> <span class="n">labmda</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">value</span> <span class="n">outside</span> <span class="n">labmda</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">value</span> <span class="ow">in</span> <span class="n">labmda</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">value</span> <span class="ow">in</span> <span class="n">labmda</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">value</span> <span class="n">outside</span> <span class="n">labmda</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">value</span> <span class="n">outside</span> <span class="n">labmda</span><span class="p">:</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Labmda 表达式中的 <code class="docutils literal notranslate"><span class="pre">[]</span></code> 是 <cite>captures</cite> 表示如果在 Lambda 表达式内部如
何访问外部的变量:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">[=]</span></code> :</p>
<p>Lambda 表达式内部全部都按值（by value）的方式访问外部变量;</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">[&amp;]</span></code> :</p>
<p>Lambda 表达式内部全部都按引用（by reference）的方式访问外部变量;</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">[a,&amp;b]</span></code> :</p>
<p>Lambda 表达式内部按值（by value）的方式访问外部变量 <code class="docutils literal notranslate"><span class="pre">a</span></code> ，按引用
（by reference）的方式访问外部变量 <code class="docutils literal notranslate"><span class="pre">b</span></code> 。</p>
</li>
</ul>
</div></blockquote>
<p>关于上述代码中 <cite>mutable</cite> 的使用，可参考前面的章节 <a class="reference internal" href="#c-mutable"><span class="std std-ref">32. C++ 中的 Mutable 关键字</span></a> 。</p>
<p>更多详细的信息可参考 <a class="reference external" href="https://en.cppreference.com/w/cpp/language/lambda">Lambda expressions (since C++11)</a> 。</p>
</div>
<div class="section" id="std">
<h3>57. 为什么不使用 std 命名空间<a class="headerlink" href="#std" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id41">
<h3>58. C++ 中的命名空间<a class="headerlink" href="#id41" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id42">
<h3>59. C++ 中的线程<a class="headerlink" href="#id42" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="c-timing">
<h3>60. C++ 中的计时（Timing）<a class="headerlink" href="#c-timing" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;chrono&gt;</span><span class="cp"></span>

<span class="k">struct</span>  <span class="n">Timer</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">steady_clock</span><span class="o">&gt;</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">duration</span><span class="p">;</span>
    <span class="n">Timer</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="o">~</span><span class="n">Timer</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">ms</span> <span class="o">=</span> <span class="n">duration</span><span class="p">.</span><span class="n">count</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1000.0f</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Timer took &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ms</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;ms&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;chrono&gt;</span><span class="cp"></span>

<span class="k">struct</span>  <span class="n">Timer</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Timer</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">m_StartTimepoint</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="o">~</span><span class="n">Timer</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Stop</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">Stop</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">endTimepoint</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

        <span class="k">auto</span> <span class="n">start</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_point_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">microseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_StartTimepoint</span><span class="p">).</span><span class="n">time_since_epoch</span><span class="p">().</span><span class="n">count</span><span class="p">();</span>
        <span class="k">auto</span> <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_point_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">microseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">endTimepoint</span><span class="p">).</span><span class="n">time_since_epoch</span><span class="p">().</span><span class="n">count</span><span class="p">();</span>
        <span class="k">auto</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">;</span>

        <span class="kt">double</span> <span class="n">ms</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">*</span> <span class="mf">0.001</span><span class="p">;</span>

        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">duration</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;us (&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ms</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;ms) </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">&gt;</span> <span class="n">m_StartTimepoint</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id43">
<h3>61. C++ 中的多维数组<a class="headerlink" href="#id43" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id44">
<h3>62. C++ 中的排序<a class="headerlink" href="#id44" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="c-type-punning">
<h3>63. C++ 中的（Type Punning）<a class="headerlink" href="#c-type-punning" title="永久链接至标题">¶</a></h3>
<p>将类型 <cite>A</cite> 的指针转换为类型 <cite>B</cite> 的指针，然后按照类型 <cite>B</cite> 来操作关联的内存。</p>
</div>
<div class="section" id="c-unions">
<h3>64. C++ 中的 Unions<a class="headerlink" href="#c-unions" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">Vector2</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Vector4</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">w</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">stream</span> <span class="o">&lt;&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">stream</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vector4</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">stream</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">.</span><span class="n">z</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">stream</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">MyUnion</span>
<span class="p">{</span>
<span class="hll">    <span class="k">union</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">Vector4</span> <span class="n">v4</span><span class="p">;</span>
</span><span class="hll">        <span class="k">struct</span>
</span><span class="hll">        <span class="p">{</span>
</span><span class="hll">            <span class="n">Vector2</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
</span><span class="hll">        <span class="p">};</span>
</span><span class="hll">    <span class="p">};</span>
</span><span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">MyUnion</span> <span class="n">data</span><span class="p">;</span>
    <span class="n">data</span><span class="p">.</span><span class="n">v4</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
    <span class="n">data</span><span class="p">.</span><span class="n">v4</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">2.0f</span><span class="p">;</span>
    <span class="n">data</span><span class="p">.</span><span class="n">v4</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">3.0f</span><span class="p">;</span>
    <span class="n">data</span><span class="p">.</span><span class="n">v4</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="mf">4.0f</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">v4</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span>
<span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="mi">3</span><span class="p">,</span> <span class="mi">4</span>
</pre></div>
</div>
</div>
<div class="section" id="id45">
<h3>65. C++ 中的虚构造函数<a class="headerlink" href="#id45" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span>  <span class="nc">Base</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Base</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Base Constructed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">~</span><span class="n">Base</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Base Destructed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span>  <span class="nc">Derived</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Base</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Derived</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Derived Constructed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">~</span><span class="n">Derived</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Derived Destructed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Base</span><span class="o">*</span> <span class="n">base</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Base</span><span class="p">;</span>
    <span class="k">delete</span> <span class="n">base</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;--------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="n">Derived</span><span class="o">*</span> <span class="n">derived</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="p">;</span>
    <span class="k">delete</span> <span class="n">derived</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;--------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="hll">    <span class="n">Base</span><span class="o">*</span> <span class="n">poly</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="p">;</span>
</span><span class="hll">    <span class="k">delete</span> <span class="n">poly</span><span class="p">;</span>
</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Base</span> <span class="n">Constructed</span><span class="o">.</span>
<span class="n">Base</span> <span class="n">Destructed</span><span class="o">.</span>
<span class="o">--------------------------</span>
<span class="n">Base</span> <span class="n">Constructed</span><span class="o">.</span>
<span class="n">Derived</span> <span class="n">Constructed</span><span class="o">.</span>
<span class="n">Derived</span> <span class="n">Destructed</span><span class="o">.</span>
<span class="n">Base</span> <span class="n">Destructed</span><span class="o">.</span>
<span class="o">--------------------------</span>
<span class="n">Base</span> <span class="n">Constructed</span><span class="o">.</span>
<span class="n">Derived</span> <span class="n">Constructed</span><span class="o">.</span>
<span class="n">Base</span> <span class="n">Destructed</span><span class="o">.</span>
</pre></div>
</div>
<p>可以看到 <code class="docutils literal notranslate"><span class="pre">poly</span></code> 变量在被销毁的时候并没有正确地调用 <code class="docutils literal notranslate"><span class="pre">Derived::~Derived()</span></code>
这个析构函数，这是因为 <code class="docutils literal notranslate"><span class="pre">poly</span></code> 被以指向 <code class="docutils literal notranslate"><span class="pre">Base</span></code> 类型地指针对待，在 <code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">poly;</span></code>
调用的时候无法知道其是否具有派生类的析构函数。</p>
<p>为了解决这个问题，将基类的析构函数设置为虚函数即可：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="k">virtual</span> <span class="o">~</span><span class="n">Base</span><span class="p">()</span>
</span></pre></div>
</td></tr></table></div>
<p>调整后的输出：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Base</span> <span class="n">Constructed</span><span class="o">.</span>
<span class="n">Base</span> <span class="n">Destructed</span><span class="o">.</span>
<span class="o">--------------------------</span>
<span class="n">Base</span> <span class="n">Constructed</span><span class="o">.</span>
<span class="n">Derived</span> <span class="n">Constructed</span><span class="o">.</span>
<span class="n">Derived</span> <span class="n">Destructed</span><span class="o">.</span>
<span class="n">Base</span> <span class="n">Destructed</span><span class="o">.</span>
<span class="o">--------------------------</span>
<span class="n">Base</span> <span class="n">Constructed</span><span class="o">.</span>
<span class="n">Derived</span> <span class="n">Constructed</span><span class="o">.</span>
<span class="n">Derived</span> <span class="n">Destructed</span><span class="o">.</span>
<span class="n">Base</span> <span class="n">Destructed</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="id46">
<h3>66. C++ 中的类型转换<a class="headerlink" href="#id46" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">value</span> <span class="o">=</span> <span class="mf">5.3</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>               <span class="c1">// C style</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>  <span class="c1">// C++ style</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>C++ style:</p>
<blockquote>
<div><ul class="simple">
<li><p>static_cast</p></li>
<li><p>dynamic_cast</p></li>
<li><p>const_cast</p></li>
<li><p>reinterpret_cast</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id47">
<h3>67. C++ 中的条件和动作断点<a class="headerlink" href="#id47" title="永久链接至标题">¶</a></h3>
<p>略。</p>
</div>
<div class="section" id="id48">
<h3>68. 现代 C++ 中的安全<a class="headerlink" href="#id48" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id49">
<h3>69. C++ 中的预编译头文件<a class="headerlink" href="#id49" title="永久链接至标题">¶</a></h3>
<p>使用方式：</p>
<ol class="arabic">
<li><p>pch.h</p>
<p>在一个头文件中包含需要预编译的头文件信息。</p>
</li>
<li><p>pch.cpp</p>
<ol class="arabic">
<li><p>在一个 <cite>.cpp</cite> 文件中 <cite>include</cite> 上一步中的头文件。</p>
<div class="literal-block-wrapper docutils container" id="id84">
<div class="code-block-caption"><span class="caption-text">pch.cpp</span><a class="headerlink" href="#id84" title="永久链接至代码">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&quot;pch.h&quot;</span><span class="cp"></span>
</pre></div>
</td></tr></table></div>
</div>
</li>
<li><p>在该文件的 Properties -&gt; Configuration Properties -&gt; C/C++ -&gt; Precompiled Header -&gt; Precompiled Header : <cite>Create (/Yc)</cite></p></li>
</ol>
</li>
<li><p>修改项目相关属性</p>
<ol class="arabic simple">
<li><p>在项目的 Properties -&gt; Configuration Properties -&gt; C/C++ -&gt; Precompiled Header -&gt; Precompiled Header : <cite>Use (/Yu)</cite></p></li>
<li><p>在项目的 Properties -&gt; Configuration Properties -&gt; C/C++ -&gt; Precompiled Header -&gt; Precompiled Header File : <cite>pch.h</cite></p></li>
</ol>
</li>
</ol>
<p>缺点：</p>
<blockquote>
<div><ul class="simple">
<li><p>使用预编译头文件的项目中不太好知道项目依赖于哪些库</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="c-dynamic-casting">
<h3>70. C++ 中的动态类型转换（Dynamic Casting）<a class="headerlink" href="#c-dynamic-casting" title="永久链接至标题">¶</a></h3>
<p>C++ 中的动态类型转换是在运行时发生的，因此会有一定的性能开销。动态类型转换通常是
发生在类的继承树中，检查一个以基类类型命名的变量中存储的是否是某个子类的实例。</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
<span class="hll"><span class="k">public</span><span class="o">:</span>
</span><span class="hll">    <span class="kt">void</span> <span class="k">virtual</span> <span class="n">PrintName</span><span class="p">()</span> <span class="p">{};</span>
</span><span class="p">};</span>

<span class="k">class</span> <span class="nc">Player</span> <span class="o">:</span><span class="k">public</span> <span class="n">Entity</span>
<span class="p">{</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Enemy</span> <span class="o">:</span><span class="k">public</span> <span class="n">Entity</span>
<span class="p">{</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Player</span><span class="o">*</span> <span class="n">player</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Player</span><span class="p">;</span>
    <span class="n">Enemy</span><span class="o">*</span> <span class="n">enemy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Enemy</span><span class="p">;</span>

<span class="hll">    <span class="n">Player</span><span class="o">*</span> <span class="n">p0</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">Player</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">player</span><span class="p">);</span>     <span class="c1">// cast success. p0 will be some value</span>
</span><span class="hll">    <span class="n">Player</span><span class="o">*</span> <span class="n">p1</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">Player</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">enemy</span><span class="p">);</span>      <span class="c1">// cast failed. p1 will be nullptr</span>
</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>C++ 使用 RTTI(Run time type information) 来实现运行时的动态类型转换，有一定的开
销，在 Visual Studio 中的项目的 Properties -&gt; Configuration Properties -&gt; C/C++
-&gt; Language -&gt; Enable Run-Time Type Information 选项中可开启或禁用，禁用后编译的
代码中的动态类型转换相关的代码会出现不可预知的行为。</p>
</div>
<div class="section" id="id50">
<h3>71. C++ 中的性能测试（如何测量性能）<a class="headerlink" href="#id50" title="永久链接至标题">¶</a></h3>
<p>注意在 <cite>Debug</cite> 和 <cite>Release</cite> 模式下存在编译后代码的差异。</p>
<p>测试一：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;chrono&gt;</span><span class="cp"></span>

<span class="k">struct</span>  <span class="n">Timer</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Timer</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">m_StartTimepoint</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="o">~</span><span class="n">Timer</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Stop</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">Stop</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">endTimepoint</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

        <span class="k">auto</span> <span class="n">start</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_point_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">microseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_StartTimepoint</span><span class="p">).</span><span class="n">time_since_epoch</span><span class="p">().</span><span class="n">count</span><span class="p">();</span>
        <span class="k">auto</span> <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_point_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">microseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">endTimepoint</span><span class="p">).</span><span class="n">time_since_epoch</span><span class="p">().</span><span class="n">count</span><span class="p">();</span>
        <span class="k">auto</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">;</span>

        <span class="kt">double</span> <span class="n">ms</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">*</span> <span class="mf">0.001</span><span class="p">;</span>

        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">duration</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;us (&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ms</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;ms) </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">&gt;</span> <span class="n">m_StartTimepoint</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">{</span>
        <span class="n">Timer</span> <span class="n">timer</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">__debugbreak</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出（Debug）：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">8935</span><span class="n">us</span> <span class="p">(</span><span class="mf">8.935</span><span class="n">ms</span><span class="p">)</span>
<span class="mi">2000000</span>
</pre></div>
</div>
<p>输出（Release）：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="n">us</span> <span class="p">(</span><span class="mf">0.001</span><span class="n">ms</span><span class="p">)</span>
<span class="mi">2000000</span>
</pre></div>
</div>
</div></blockquote>
<p>测试二：</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;chrono&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;array&gt;</span><span class="cp"></span>

<span class="k">struct</span>  <span class="n">Timer</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Timer</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">m_StartTimepoint</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="o">~</span><span class="n">Timer</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Stop</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">Stop</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">endTimepoint</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

        <span class="k">auto</span> <span class="n">start</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_point_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">microseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_StartTimepoint</span><span class="p">).</span><span class="n">time_since_epoch</span><span class="p">().</span><span class="n">count</span><span class="p">();</span>
        <span class="k">auto</span> <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_point_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">microseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">endTimepoint</span><span class="p">).</span><span class="n">time_since_epoch</span><span class="p">().</span><span class="n">count</span><span class="p">();</span>
        <span class="k">auto</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">;</span>

        <span class="kt">double</span> <span class="n">ms</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">*</span> <span class="mf">0.001</span><span class="p">;</span>

        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">duration</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;us (&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ms</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;ms) </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">&gt;</span> <span class="n">m_StartTimepoint</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">Vector2</span>
    <span class="p">{</span>
        <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Make Shared</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Vector2</span><span class="o">&gt;</span><span class="p">,</span> <span class="mi">1000</span><span class="o">&gt;</span> <span class="n">ptrs</span><span class="p">;</span>
        <span class="n">Timer</span> <span class="n">timer</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ptrs</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">ptrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Vector2</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;New Shared</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Vector2</span><span class="o">&gt;</span><span class="p">,</span> <span class="mi">1000</span><span class="o">&gt;</span> <span class="n">ptrs</span><span class="p">;</span>
        <span class="n">Timer</span> <span class="n">timer</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ptrs</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">ptrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Vector2</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">Vector2</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Make Unique</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Vector2</span><span class="o">&gt;</span><span class="p">,</span> <span class="mi">1000</span><span class="o">&gt;</span> <span class="n">ptrs</span><span class="p">;</span>
        <span class="n">Timer</span> <span class="n">timer</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ptrs</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">ptrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Vector2</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">__debugbreak</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出（Debug）：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Make</span> <span class="n">Shared</span>
<span class="mi">1142</span><span class="n">us</span> <span class="p">(</span><span class="mf">1.142</span><span class="n">ms</span><span class="p">)</span>
<span class="n">New</span> <span class="n">Shared</span>
<span class="mi">1476</span><span class="n">us</span> <span class="p">(</span><span class="mf">1.476</span><span class="n">ms</span><span class="p">)</span>
<span class="n">Make</span> <span class="n">Unique</span>
<span class="mi">990</span><span class="n">us</span> <span class="p">(</span><span class="mf">0.99</span><span class="n">ms</span><span class="p">)</span>
</pre></div>
</div>
<p>输出（Release）：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Make</span> <span class="n">Shared</span>
<span class="mi">112</span><span class="n">us</span> <span class="p">(</span><span class="mf">0.112</span><span class="n">ms</span><span class="p">)</span>
<span class="n">New</span> <span class="n">Shared</span>
<span class="mi">292</span><span class="n">us</span> <span class="p">(</span><span class="mf">0.292</span><span class="n">ms</span><span class="p">)</span>
<span class="n">Make</span> <span class="n">Unique</span>
<span class="mi">89</span><span class="n">us</span> <span class="p">(</span><span class="mf">0.089</span><span class="n">ms</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="c-17-structured-bindings">
<h3>72. C++ 17 中的结构化绑定（Structured Bindings）<a class="headerlink" href="#c-17-structured-bindings" title="永久链接至标题">¶</a></h3>
<p>从 C++ 17 开始的一种可以让方法有多个返回值的方式，在 Visual Studio 中的项目
的 Properties -&gt; Configuration Properties -&gt; C/C++ -&gt; Language -&gt; C++ Language Standard : ISO C++17 Standard (/std:c++17)</p>
<ul>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">std::tuple</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">std::pair</span></code> :</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;tuple&gt;</span><span class="cp"></span>

<span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">CreatePerson</span><span class="p">()</span> <span class="c1">// 或者 std::pair&lt;std::string, int&gt; CreatePerson()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;Cherno&quot;</span><span class="p">,</span><span class="mi">24</span> <span class="p">};</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 方式一</span>
    <span class="k">auto</span> <span class="n">person</span> <span class="o">=</span> <span class="n">CreatePerson</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>

    <span class="c1">// 方式二</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">age2</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">name2</span><span class="p">,</span> <span class="n">age2</span><span class="p">)</span> <span class="o">=</span> <span class="n">CreatePerson</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>使用 Structured Bindings :</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;tuple&gt;</span><span class="cp"></span>

<span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">CreatePerson</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;Cherno&quot;</span><span class="p">,</span><span class="mi">24</span> <span class="p">};</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
<span class="hll">    <span class="k">auto</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">]</span> <span class="o">=</span> <span class="n">CreatePerson</span><span class="p">();</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">name</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">age</span> <span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<div class="section" id="c-17-optional-data">
<h3>73. C++ 17 中如何处理可选数据（Optional Data）<a class="headerlink" href="#c-17-optional-data" title="永久链接至标题">¶</a></h3>
<p>C++ 17 引入的 <code class="docutils literal notranslate"><span class="pre">std::optional</span></code> 类似于 C# 中的 <code class="docutils literal notranslate"><span class="pre">Nullable</span></code> 。</p>
<ul>
<li><p>常规处理方式：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>

<span class="hll"><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ReadFileAsString</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">filePath</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&amp;</span> <span class="n">outSuccess</span><span class="p">)</span>
</span><span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">stream</span><span class="p">(</span><span class="n">filePath</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">stream</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span>  <span class="n">result</span><span class="p">;</span>
        <span class="c1">// read file</span>
        <span class="n">stream</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="hll">        <span class="n">outSuccess</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span>        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="hll">    <span class="n">outSuccess</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">();</span>
</span><span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
<span class="hll">    <span class="kt">bool</span> <span class="n">fileOpendSuccessfully</span><span class="p">;</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">data</span> <span class="o">=</span> <span class="n">ReadFileAsString</span><span class="p">(</span><span class="s">&quot;data.txt&quot;</span><span class="p">,</span> <span class="n">fileOpendSuccessfully</span><span class="p">);</span>
</span><span class="hll">    <span class="k">if</span> <span class="p">(</span><span class="n">fileOpendSuccessfully</span><span class="p">)</span>
</span>    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;File read successfully!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;File could not be opened!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">std::optional</span></code> ：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>
<span class="hll"><span class="cp">#include</span><span class="cpf">&lt;optional&gt;</span><span class="cp"></span>
</span>
<span class="hll"><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">ReadFileAsString</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">filePath</span><span class="p">)</span>
</span><span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">stream</span><span class="p">(</span><span class="n">filePath</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">stream</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span>  <span class="n">result</span><span class="p">;</span>
        <span class="c1">// read file</span>
        <span class="n">stream</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="hll">    <span class="k">return</span> <span class="p">{};</span>
</span><span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">ReadFileAsString</span><span class="p">(</span><span class="s">&quot;data.txt&quot;</span><span class="p">);</span>
</span><span class="hll">    <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">has_value</span><span class="p">())</span>
</span>    <span class="p">{</span>
<span class="hll">        <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">content1</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
</span><span class="hll">        <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">content2</span> <span class="o">=</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
</span>
<span class="hll">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;File read successfully!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span>    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;File could not be opened!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<div class="section" id="c-17">
<h3>74. C++ 17 中让一个变量拥有多种类型<a class="headerlink" href="#c-17" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>基本使用</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="hll"><span class="cp">#include</span><span class="cpf">&lt;variant&gt;</span><span class="cp"></span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">;</span>
</span>
<span class="hll">    <span class="n">data</span> <span class="o">=</span> <span class="s">&quot;Cherno&quot;</span><span class="p">;</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span>
<span class="hll">    <span class="n">data</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span>
    <span class="c1">// std::cout &lt;&lt; std::get&lt;std::string&gt;(data) &lt;&lt; &quot;\n&quot;; // 这里会泡抛出异常</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>检查变量中存储的类型：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;variant&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="s">&quot;Cherno&quot;</span><span class="p">;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="hll">    <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">index</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span>    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="hll">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">index</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span>    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>或者：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;variant&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="s">&quot;Cherno&quot;</span><span class="p">;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="hll">    <span class="k">if</span> <span class="p">(</span><span class="k">auto</span> <span class="n">value</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get_if</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">))</span>
</span>    <span class="p">{</span>
<span class="hll">        <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">v</span> <span class="o">=</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>
</span>        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="hll">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">auto</span> <span class="n">value</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get_if</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">))</span>
</span>    <span class="p">{</span>
<span class="hll">        <span class="kt">int</span><span class="o">&amp;</span> <span class="n">v</span> <span class="o">=</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>
</span>        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>检查变量中存储的类型：</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;variant&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">;</span>

<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>               <span class="c1">// output will be 4</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>       <span class="c1">// output will be 28</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>              <span class="c1">// output will be 32</span>
</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p><cite>variant</cite> 的底层实现有些像类中包含了多个成员变量，没有 <code class="docutils literal notranslate"><span class="pre">unino</span></code> 那样的
高效，但是更安全一些。</p>
</li>
<li><p>其它使用场景</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;variant&gt;</span><span class="cp"></span>
<span class="hll"><span class="cp">#include</span><span class="cpf">&lt;optional&gt;</span><span class="cp"></span>
</span>
<span class="hll"><span class="k">enum</span>  <span class="n">ErrorCode</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">    <span class="n">None</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NorFound</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NoAccess</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class="hll"><span class="p">};</span>
</span>
<span class="hll"><span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">ReadFileAsString</span><span class="p">()</span>
</span><span class="p">{</span>
    <span class="k">return</span> <span class="p">{};</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<div class="section" id="c-17-how-to-store-any-data-in-c">
<h3>75. C++ 17 How to store ANY data in C++<a class="headerlink" href="#c-17-how-to-store-any-data-in-c" title="永久链接至标题">¶</a></h3>
<p>浏览的 C++ 源码得知 <code class="docutils literal notranslate"><span class="pre">std::any</span></code> 类型的变量在当存储到其中的数据较小时，使用栈来
存储；当数据较大时，使用堆来存储。作为比较 <code class="docutils literal notranslate"><span class="pre">std::variant</span></code> 则不会存在动态分配内
存的情况，性能可能会好一些。</p>
<ul>
<li><p>常规使用</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="hll"><span class="cp">#include</span><span class="cpf">&lt;any&gt;</span><span class="cp"></span>
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">any</span> <span class="n">data</span><span class="p">;</span>
</span><span class="hll">    <span class="n">data</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class="hll">    <span class="n">data</span> <span class="o">=</span> <span class="s">&quot;Cherno&quot;</span><span class="p">;</span> <span class="c1">//  const char*</span>
</span><span class="hll">    <span class="n">data</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">&quot;Cherno&quot;</span><span class="p">);</span>
</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">string</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">any_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">);</span> <span class="c1">// pay attention to try catch</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">string2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">any_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p>其他</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="cpf">&lt;any&gt;</span><span class="cp"></span>

<span class="hll"><span class="kt">void</span><span class="o">*</span> <span class="k">operator</span> <span class="nf">new</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="c1">// 兼容性不是很好</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="k">struct</span> <span class="n">CustomClass</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s0</span><span class="p">,</span> <span class="n">s1</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">any</span> <span class="n">data</span><span class="p">;</span>
<span class="hll">    <span class="n">data</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>               <span class="c1">// use stack</span>
</span><span class="hll">    <span class="n">data</span> <span class="o">=</span> <span class="n">CustomClass</span><span class="p">();</span>   <span class="c1">// use heap with big poiner</span>
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
<div class="section" id="c-std-async">
<h3>76. 如何让 C++ 运行更快（std-async）<a class="headerlink" href="#c-std-async" title="永久链接至标题">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="hll"><span class="cp">#include</span><span class="cpf">&lt;future&gt;</span><span class="cp"></span>
</span>
<span class="hll"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;&gt;</span> <span class="n">m_Futures</span><span class="p">;</span>
</span>
<span class="hll"><span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">mutex</span> <span class="n">s_MeshMutex</span><span class="p">;</span>
</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">LoadMesh</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">s_MeshMutex</span><span class="p">);</span>
</span><span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">LoadMesh</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">s_MeshMutex</span><span class="p">);</span>
</span>    <span class="c1">// other operations</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">meshFilepaths</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">file</span> <span class="p">:</span> <span class="n">meshFilepaths</span><span class="p">)</span>
    <span class="p">{</span>
<span class="hll">        <span class="n">m_Futures</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">async</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">launch</span><span class="o">::</span><span class="n">async</span><span class="p">,</span> <span class="n">LoadMesh</span><span class="p">,</span> <span class="n">file</span><span class="p">));</span>
</span>    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="c-17-string">
<h3>77. C++ 17 如何让 String 更快<a class="headerlink" href="#c-17-string" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>常规写法</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">s_Allocations</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span><span class="o">*</span> <span class="k">operator</span> <span class="nf">new</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">s_Allocations</span><span class="o">++</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Allocating &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">size</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; bytes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">PrintName</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Yan Chernikov&quot;</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">firstName</span> <span class="o">=</span> <span class="n">name</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">lastName</span> <span class="o">=</span> <span class="n">name</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>

    <span class="n">PrintName</span><span class="p">(</span><span class="s">&quot;Yan Chernikov&quot;</span><span class="p">);</span>
    <span class="n">PrintName</span><span class="p">(</span><span class="n">firstName</span><span class="p">);</span>
    <span class="n">PrintName</span><span class="p">(</span><span class="n">lastName</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s_Allocations</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; allocations &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Allocating</span> <span class="mi">8</span> <span class="nb">bytes</span>
<span class="n">Allocating</span> <span class="mi">8</span> <span class="nb">bytes</span>
<span class="n">Allocating</span> <span class="mi">8</span> <span class="nb">bytes</span>
<span class="n">Allocating</span> <span class="mi">8</span> <span class="nb">bytes</span>
<span class="n">Yan</span> <span class="n">Chernikov</span>
<span class="n">Yan</span>
<span class="n">Chernikov</span>
<span class="mi">4</span> <span class="n">allocations</span>
</pre></div>
</div>
<p>四次内存分配发生在第18，20，21和23这几行。</p>
</li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">std::string_view</span></code></p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">s_Allocations</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span><span class="o">*</span> <span class="k">operator</span> <span class="nf">new</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">s_Allocations</span><span class="o">++</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Allocating &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">size</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; bytes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="hll"><span class="kt">void</span> <span class="nf">PrintName</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">name</span><span class="p">)</span>
</span><span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Yan Chernikov&quot;</span><span class="p">;</span>

<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">firstName</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="mi">4</span><span class="p">);</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">lastName</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
</span>
    <span class="n">PrintName</span><span class="p">(</span><span class="s">&quot;Yan Chernikov&quot;</span><span class="p">);</span>
    <span class="n">PrintName</span><span class="p">(</span><span class="n">firstName</span><span class="p">);</span>
    <span class="n">PrintName</span><span class="p">(</span><span class="n">lastName</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s_Allocations</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; allocations &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Allocating</span> <span class="mi">8</span> <span class="nb">bytes</span>
<span class="n">Yan</span> <span class="n">Chernikov</span>
<span class="n">Yan</span>
<span class="n">Chernikov</span>
<span class="mi">1</span> <span class="n">allocations</span>
</pre></div>
</div>
<p>唯一的一次内存分配发生在第18行。</p>
</li>
<li><p>继续优化</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">s_Allocations</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span><span class="o">*</span> <span class="k">operator</span> <span class="nf">new</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">s_Allocations</span><span class="o">++</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Allocating &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">size</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; bytes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">PrintName</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Yan Chernikov&quot;</span><span class="p">;</span>
</span>
<span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">firstName</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span><span class="hll">    <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">lastName</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
</span>
    <span class="n">PrintName</span><span class="p">(</span><span class="s">&quot;Yan Chernikov&quot;</span><span class="p">);</span>
    <span class="n">PrintName</span><span class="p">(</span><span class="n">firstName</span><span class="p">);</span>
    <span class="n">PrintName</span><span class="p">(</span><span class="n">lastName</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s_Allocations</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; allocations &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Yan</span> <span class="n">Chernikov</span>
<span class="n">Yan</span>
<span class="n">Chernikov</span>
<span class="mi">0</span> <span class="n">allocations</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="id51">
<h3>78. C++ 中让性能测试可视化<a class="headerlink" href="#id51" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id52">
<h3>79. C++ 中的单例<a class="headerlink" href="#id52" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id53">
<h3>80. C++ 中对短字符串的优化<a class="headerlink" href="#id53" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id54">
<h3>81. C++ 中以最简单的方式对内存分配进行跟踪<a class="headerlink" href="#id54" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id55">
<h3>82. C++ 的左值和右值<a class="headerlink" href="#id55" title="永久链接至标题">¶</a></h3>
<p>C++ 中的左值 ( <cite>lvalue</cite> ) 是指已经分配内存的对象；而右值（ <cite>rvalue</cite> ）是指
尚未为其分配内存的对象。</p>
<p>在类型名后面加一个 <cite>&amp;</cite> 以声明左值类型，加两个 <cite>&amp;</cite> 以声明右值类型，仅在函数的
参数列表中可以使用这两种类型进行声明。</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">Print</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">first</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;&amp;</span> <span class="n">last</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// do something here</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id56">
<h3>83. C++ 中的持续集成<a class="headerlink" href="#id56" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://www.jenkins.io/">jenkins</a> <a class="reference external" href="https://www.linode.com/">linode</a></p>
</div>
<div class="section" id="id57">
<h3>84. C++ 中的静态分析<a class="headerlink" href="#id57" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pvs-studio.com/en/">PVS-Studio</a></p>
</div>
<div class="section" id="c-evaluation">
<h3>85. C++ 中参数 evaluation 顺序<a class="headerlink" href="#c-evaluation" title="永久链接至标题">¶</a></h3>
<p>C++ 中没有规定参数被 evalueated 的顺序，但在 C++ 17 中规定了 ++i 在 i++ 之
前被 evaluated。</p>
</div>
<div class="section" id="c-move-semantics">
<h3>86. C++ 中的 Move 含义（semantics）<a class="headerlink" href="#c-move-semantics" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>第一版代码</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="k">class</span> <span class="nc">String</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">m_Data</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">m_Size</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">String</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

    <span class="n">String</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">string</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Constructed!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">m_Size</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
        <span class="n">m_Data</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">m_Size</span><span class="p">];</span>

        <span class="n">memcpy</span><span class="p">(</span><span class="n">m_Data</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">m_Size</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">String</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span><span class="o">&amp;</span> <span class="n">copiedObject</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Copied!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">m_Size</span> <span class="o">=</span> <span class="n">copiedObject</span><span class="p">.</span><span class="n">m_Size</span><span class="p">;</span>
        <span class="n">m_Data</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">copiedObject</span><span class="p">.</span><span class="n">m_Size</span><span class="p">];</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="n">m_Data</span><span class="p">,</span> <span class="n">copiedObject</span><span class="p">.</span><span class="n">m_Data</span><span class="p">,</span> <span class="n">m_Size</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">~</span><span class="n">String</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Destroyed!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">delete</span> <span class="n">m_Data</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">Print</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m_Size</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="n">m_Data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span>  <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span>
<span class="hll">        <span class="o">:</span> <span class="n">m_Name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span>    <span class="p">{</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">PrintName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">m_Name</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">String</span> <span class="n">m_Name</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">{</span>
<span class="hll">        <span class="n">Entity</span> <span class="n">entity</span><span class="p">(</span><span class="s">&quot;Cherno&quot;</span><span class="p">);</span>    <span class="c1">// same as: Entity entity(String(&quot;Cherno&quot;));</span>
</span>        <span class="n">entity</span><span class="p">.</span><span class="n">PrintName</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Constructed!
Copied!
Destroyed!
Cherno
Destroyed!
</pre></div>
</div>
<ul class="simple">
<li><p><cite>main</cite> 函数中的代码 <code class="docutils literal notranslate"><span class="pre">Entity</span> <span class="pre">entity(&quot;Cherno&quot;);</span></code> 会调用 <code class="docutils literal notranslate"><span class="pre">String::String(const</span> <span class="pre">char*</span> <span class="pre">string)</span></code>
构造函数将参数 <cite>“Cherno”</cite> 进行隐式类型转换；</p></li>
<li><p>然后在调用 <code class="docutils literal notranslate"><span class="pre">Entity::Entity(const</span> <span class="pre">String&amp;</span> <span class="pre">name):</span> <span class="pre">m_Name(name)</span></code>
构造函数时， <code class="docutils literal notranslate"><span class="pre">m_Name(name)</span></code> 会调用 <code class="docutils literal notranslate"><span class="pre">String(const</span> <span class="pre">String&amp;</span> <span class="pre">copiedObject)</span></code>
进行一次拷贝构造（copy construct）。</p></li>
</ul>
</li>
<li><p>第二版代码</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="k">class</span>  <span class="nc">String</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">m_Data</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">m_Size</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">String</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

    <span class="n">String</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">string</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Constructed!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">m_Size</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
        <span class="n">m_Data</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">m_Size</span><span class="p">];</span>

        <span class="n">memcpy</span><span class="p">(</span><span class="n">m_Data</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">m_Size</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">String</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span><span class="o">&amp;</span> <span class="n">copiedObject</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Copied!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">m_Size</span> <span class="o">=</span> <span class="n">copiedObject</span><span class="p">.</span><span class="n">m_Size</span><span class="p">;</span>
        <span class="n">m_Data</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">copiedObject</span><span class="p">.</span><span class="n">m_Size</span><span class="p">];</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="n">m_Data</span><span class="p">,</span> <span class="n">copiedObject</span><span class="p">.</span><span class="n">m_Data</span><span class="p">,</span> <span class="n">m_Size</span><span class="p">);</span>
    <span class="p">}</span>

<span class="hll">    <span class="n">String</span><span class="p">(</span><span class="n">String</span><span class="o">&amp;&amp;</span> <span class="n">movedObject</span><span class="p">)</span> <span class="k">noexcept</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Moved!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class="hll">        <span class="n">m_Size</span> <span class="o">=</span> <span class="n">movedObject</span><span class="p">.</span><span class="n">m_Size</span><span class="p">;</span>
</span><span class="hll">        <span class="n">m_Data</span> <span class="o">=</span> <span class="n">movedObject</span><span class="p">.</span><span class="n">m_Data</span><span class="p">;</span>
</span><span class="hll">
</span><span class="hll">        <span class="n">movedObject</span><span class="p">.</span><span class="n">m_Size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="hll">        <span class="n">movedObject</span><span class="p">.</span><span class="n">m_Data</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span>
    <span class="o">~</span><span class="n">String</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Destroyed!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">delete</span> <span class="n">m_Data</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">Print</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m_Size</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="n">m_Data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span>  <span class="nc">Entity</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Entity</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">m_Name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

<span class="hll">    <span class="n">Entity</span><span class="p">(</span><span class="n">String</span><span class="o">&amp;&amp;</span> <span class="n">name</span><span class="p">)</span>
</span><span class="hll">        <span class="o">:</span> <span class="n">m_Name</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="c1">// same as: m_Name((String&amp;&amp;)name)</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">    <span class="p">}</span>
</span>
    <span class="kt">void</span> <span class="n">PrintName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">m_Name</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">String</span> <span class="n">m_Name</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">{</span>
        <span class="n">Entity</span> <span class="n">entity</span><span class="p">(</span><span class="s">&quot;Cherno&quot;</span><span class="p">);</span>    <span class="c1">// same as: Entity entity(String(&quot;Cherno&quot;));</span>
        <span class="n">entity</span><span class="p">.</span><span class="n">PrintName</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Constructed!
Moved!
Destroyed!
Cherno
Destroyed!
</pre></div>
</div>
<ul class="simple">
<li><p>增加了 move constructor 的实现，相较第一版代码而言，移除了因拷贝构造
带来的内存分配。</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="c-move-move-assigment">
<h3>87. C++ 中的 Move 和 move assigment 操作符<a class="headerlink" href="#c-move-move-assigment" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id58">
<h3>88. C++ 中的设计数据结构<a class="headerlink" href="#id58" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="vector-dynamic-array">
<h3>89. VECTOR DYNAMIC ARRAY - 设计数据结构<a class="headerlink" href="#vector-dynamic-array" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id59">
<h3>90. C++ 中的迭代器<a class="headerlink" href="#id59" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id60">
<h3>91. 在 C++ 中写一个迭代器<a class="headerlink" href="#id60" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="id61">
<h3>92. 如何学习 C++<a class="headerlink" href="#id61" title="永久链接至标题">¶</a></h3>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="DTD.html" class="btn btn-neutral float-right" title="DTD" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="CMake.html" class="btn btn-neutral float-left" title="CMake" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2021, horizonshd.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>